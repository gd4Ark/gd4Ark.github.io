<!DOCTYPE html>
<html lang=zh>
<head>
    <!-- so meta -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="HandheldFriendly" content="True">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=5" />
    <meta name="description" content="我为什么要写周刊前几天特地写了篇文章来分享一下我为什么要办这个周刊：《我为什么要写周刊》。 我搬新家了在去年《2021 年度总结》有提到，我曾有过一段开小电动车上班的时光，通勤时间极短，幸福感倍高，但由于公司地址搬迁，就再也没有享受过这样的日子了，即便后来跳槽到新公司，通勤时间缩短了一半，但也要 40 分钟左右的通勤时间，所以，在租房合同到期后，我决定搬到公司附近。 但搬家真的好累，而且广州这几天">
<meta property="og:type" content="article">
<meta property="og:title" content="周刊第1期：搬新家了">
<meta property="og:url" content="https://4ark.me/post/weekly-01.html">
<meta property="og:site_name" content="4Ark × Blog">
<meta property="og:description" content="我为什么要写周刊前几天特地写了篇文章来分享一下我为什么要办这个周刊：《我为什么要写周刊》。 我搬新家了在去年《2021 年度总结》有提到，我曾有过一段开小电动车上班的时光，通勤时间极短，幸福感倍高，但由于公司地址搬迁，就再也没有享受过这样的日子了，即便后来跳槽到新公司，通勤时间缩短了一半，但也要 40 分钟左右的通勤时间，所以，在租房合同到期后，我决定搬到公司附近。 但搬家真的好累，而且广州这几天">
<meta property="og:locale">
<meta property="article:published_time" content="2022-02-20T00:00:00.000Z">
<meta property="article:modified_time" content="2024-02-06T18:11:56.000Z">
<meta property="article:author" content="4Ark">
<meta property="article:tag" content="weekly">
<meta name="twitter:card" content="summary">
    
    
      
        
          <link rel="shortcut icon" href="/images/favicon.ico">
        
      
      
        
          <link rel="icon" type="image/png" href="/images/favicon-192x192.png" sizes="192x192">
        
      
      
        
          <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">
        
      
    
    <!-- title -->
    <title>周刊第1期：搬新家了</title>
    <!-- styles -->
    
<link rel="stylesheet" href="/css/style.css">

    <script>localStorage.getItem("dark_mode")==="dark"&&document.write(`<link rel="stylesheet" href="${location.origin}/css/dark.css">`)</script>
    <!-- persian styles -->
    
    <!-- rss -->
    
    
	<!-- mathjax -->
	
    <meta name="google-site-verification" content="DwDg4EuywHWNZUkTC7sG0WGv_UQekM4uRtOoaGuDJHc" />
<meta name="generator" content="Hexo 5.4.0"><link rel="alternate" href="/atom.xml" title="4Ark × Blog" type="application/atom+xml">
<link rel="alternate" href="/rss.xml" title="4Ark × Blog" type="application/rss+xml">
</head>

<body class="max-width mx-auto px3 ltr">
    
      <div id="header-post">
  <a id="menu-icon" href="#" aria-label="Menu"><i class="fas fa-bars fa-lg"></i></a>
  <a id="menu-icon-tablet" href="#" aria-label="Menu"><i class="fas fa-bars fa-lg"></i></a>
  <a id="top-icon-tablet" href="#" aria-label="Top" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fas fa-chevron-up fa-lg"></i></a>
  <span id="menu">
    <span id="nav">
      <ul>
        <!--
       --><li><a href="/">Home</a></li><!--
     --><!--
       --><li><a href="/about">About</a></li><!--
     --><!--
       --><li><a href="/archives">Writing</a></li><!--
     --><!--
       --><li><a href="/weekly">Weekly</a></li><!--
     --><!--
       --><li><a href="/tags">Tags</a></li><!--
     --><!--
       --><li><a href="/search">Search</a></li><!--
     -->
      </ul>
    </span>
    <br/>
    <span id="actions">
      <ul>
        
        <li><a class="icon" aria-label="Previous post" href="/post/weekly-02.html"><i class="fas fa-chevron-left" aria-hidden="true" onmouseover="$('#i-prev').toggle();" onmouseout="$('#i-prev').toggle();"></i></a></li>
        
        
        <li><a class="icon" aria-label="Next post" href="/post/weekly-idea.html"><i class="fas fa-chevron-right" aria-hidden="true" onmouseover="$('#i-next').toggle();" onmouseout="$('#i-next').toggle();"></i></a></li>
        
        <li><a class="icon" aria-label="Back to top" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fas fa-chevron-up" aria-hidden="true" onmouseover="$('#i-top').toggle();" onmouseout="$('#i-top').toggle();"></i></a></li>
        <li><a class="icon"><i class="fa fa-moon" id="dark-btn" aria-hidden="true" onmouseover="$('#i-dark').toggle()" onmouseout="$('#i-dark').toggle()"></i></a></li>
        <li><a class="icon" target="_blank" rel="noopener" href="https://4ark.me/atom.xml" aria-label="rss"><i class="fas fa-rss"></i></a></li>
        <li><a class="icon" aria-label="Share post" href="#"><i class="fas fa-share-alt" aria-hidden="true" onmouseover="$('#i-share').toggle();" onmouseout="$('#i-share').toggle();" onclick="$('#share').toggle();return false;"></i></a></li>
      </ul>
      <span id="i-prev" class="info" style="display:none;">Previous post</span>
      <span id="i-next" class="info" style="display:none;">Next post</span>
      <span id="i-top" class="info" style="display:none;">Back to top</span>
      <span id="i-dark" class="info" style="display: none;">Switch mode</span>
      <span id="i-share" class="info" style="display:none;">Share post</span>
    </span>
    <br/>
    <div id="share" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=https://4ark.me/post/weekly-01.html"><i class="fab fa-facebook " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=https://4ark.me/post/weekly-01.html&text=周刊第1期：搬新家了"><i class="fab fa-twitter " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=https://4ark.me/post/weekly-01.html&title=周刊第1期：搬新家了"><i class="fab fa-linkedin " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=https://4ark.me/post/weekly-01.html&is_video=false&description=周刊第1期：搬新家了"><i class="fab fa-pinterest " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=周刊第1期：搬新家了&body=Check out this article: https://4ark.me/post/weekly-01.html"><i class="fas fa-envelope " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=https://4ark.me/post/weekly-01.html&title=周刊第1期：搬新家了"><i class="fab fa-get-pocket " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=https://4ark.me/post/weekly-01.html&title=周刊第1期：搬新家了"><i class="fab fa-reddit " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=https://4ark.me/post/weekly-01.html&title=周刊第1期：搬新家了"><i class="fab fa-stumbleupon " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=https://4ark.me/post/weekly-01.html&title=周刊第1期：搬新家了"><i class="fab fa-digg " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=https://4ark.me/post/weekly-01.html&name=周刊第1期：搬新家了&description="><i class="fab fa-tumblr " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://news.ycombinator.com/submitlink?u=https://4ark.me/post/weekly-01.html&t=周刊第1期：搬新家了"><i class="fab fa-hacker-news " aria-hidden="true"></i></a></li>
</ul>

    </div>
    <div id="toc">
      <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%88%91%E4%B8%BA%E4%BB%80%E4%B9%88%E8%A6%81%E5%86%99%E5%91%A8%E5%88%8A"><span class="toc-number">1.</span> <span class="toc-text">我为什么要写周刊</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%88%91%E6%90%AC%E6%96%B0%E5%AE%B6%E4%BA%86"><span class="toc-number">2.</span> <span class="toc-text">我搬新家了</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%86%E4%BA%AB%E6%96%87%E7%AB%A0"><span class="toc-number">3.</span> <span class="toc-text">分享文章</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%88%91%E5%AF%B9-Svelte-%E7%9A%84%E7%9C%8B%E6%B3%95"><span class="toc-number">3.1.</span> <span class="toc-text">我对 Svelte 的看法</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%88%91%E7%9A%84%E5%90%AF%E5%8F%91"><span class="toc-number">3.1.0.1.</span> <span class="toc-text">我的启发</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Svelte-%E7%9A%84%E5%BC%82%E6%AD%A5%E6%9B%B4%E6%96%B0%E5%AE%9E%E7%8E%B0%E5%8E%9F%E7%90%86"><span class="toc-number">3.2.</span> <span class="toc-text">Svelte 的异步更新实现原理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BC%80%E5%8F%91%E6%A8%A1%E5%BC%8F-%E2%80%9CDevelopment-Mode%E2%80%9D-%E6%98%AF%E5%A6%82%E4%BD%95%E5%B7%A5%E4%BD%9C%E7%9A%84%EF%BC%9F"><span class="toc-number">3.3.</span> <span class="toc-text">开发模式 “Development Mode” 是如何工作的？</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%88%91%E7%9A%84%E5%90%AF%E5%8F%91-1"><span class="toc-number">3.3.0.1.</span> <span class="toc-text">我的启发</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%80%9A%E4%BF%97%E6%98%93%E6%87%82%E7%9A%84%E4%BB%A3%E6%95%B0%E6%95%88%E5%BA%94"><span class="toc-number">3.4.</span> <span class="toc-text">通俗易懂的代数效应</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%98%B2%E5%BE%A1%E6%80%A7-CSS"><span class="toc-number">3.5.</span> <span class="toc-text">防御性 CSS</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%88%91%E7%9A%84%E5%90%AF%E5%8F%91-2"><span class="toc-number">3.5.0.1.</span> <span class="toc-text">我的启发</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#SSR%E3%80%81SSG%E3%80%81ISR%E3%80%81DPR-%E6%9C%89%E4%BB%80%E4%B9%88%E5%8C%BA%E5%88%AB%EF%BC%9F"><span class="toc-number">3.6.</span> <span class="toc-text">SSR、SSG、ISR、DPR 有什么区别？</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%8D%E4%BC%98%E9%9B%85%E7%9A%84-React-Hooks"><span class="toc-number">3.7.</span> <span class="toc-text">不优雅的 React Hooks</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#DevTools-%E5%AE%9E%E7%8E%B0%E5%8E%9F%E7%90%86"><span class="toc-number">3.8.</span> <span class="toc-text">DevTools 实现原理</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9C%89%E8%B6%A3%E7%9A%84%E9%93%BE%E6%8E%A5"><span class="toc-number">4.</span> <span class="toc-text">有趣的链接</span></a></li></ol>
    </div>
  </span>
</div>

    
    <div class="content index py4">
        
        <article class="post" itemscope itemtype="http://schema.org/BlogPosting">
  <header>
    
    <h1 class="posttitle" itemprop="name headline">
        周刊第1期：搬新家了
    </h1>



    <div class="meta">
      <span
        class="author"
        itemprop="author"
        itemscope
        itemtype="http://schema.org/Person"
      >
        <span itemprop="name"
          >4Ark</span
        >
      </span>
      
    <div class="postdate">
      
        <time datetime="2022-02-20T00:00:00.000Z" itemprop="datePublished">2022-02-20</time>
        
      
    </div>

 
      
        <div class="article-tag">
            <i class="fa fa-calendar-week"></i>
            <a href="/weekly">Weekly</a>
        </div>
      
    </div>
  </header>
  

  <div class="content" itemprop="articleBody"><h2 id="我为什么要写周刊"><a href="#我为什么要写周刊" class="headerlink" title="我为什么要写周刊"></a>我为什么要写周刊</h2><p>前几天特地写了篇文章来分享一下我为什么要办这个周刊：《<a href="/post/weekly-idea.html">我为什么要写周刊</a>》。</p>
<h2 id="我搬新家了"><a href="#我搬新家了" class="headerlink" title="我搬新家了"></a>我搬新家了</h2><p>在去年《<a href="/post/2021-summary.html">2021 年度总结</a>》有提到，我曾有过一段开小电动车上班的时光，通勤时间极短，幸福感倍高，但由于公司地址搬迁，就再也没有享受过这样的日子了，即便后来跳槽到新公司，通勤时间缩短了一半，但也要 40 分钟左右的通勤时间，所以，在租房合同到期后，我决定搬到公司附近。</p>
<p>但搬家真的好累，而且广州这几天连续不断地下雨，心情也变得烦躁起来，搬家过程不太顺利，期间还遗漏了物品在楼下没带上车，幸好楼下的邻居平时关系比较好，愿意帮我保管，第二天又跑回去拿。</p>
<p>但从明天开始就可以享受极短通勤距离的好处，想想还是蛮开心的。</p>
<h2 id="分享文章"><a href="#分享文章" class="headerlink" title="分享文章"></a>分享文章</h2><blockquote>
<p>一些我本周阅读过的好文章、以及我的总结和启发；非常建议你阅读原文，而不是只看这些摘要，毕竟一千个读者就有一千个哈姆雷特，而且我的理解可能是错误的。</p>
</blockquote>
<h3 id="我对-Svelte-的看法"><a href="#我对-Svelte-的看法" class="headerlink" title="我对 Svelte 的看法"></a><a target="_blank" rel="noopener" href="https://lutaonan.com/blog/svelte/">我对 Svelte 的看法</a></h3><p><em>原文地址：<a target="_blank" rel="noopener" href="https://lutaonan.com/blog/svelte/">《我对 Svelte 的看法》 | Randy’s Blog</a></em></p>
<p>简单来说 Svelte 是一个在编译时实现了 Reactivity (反应式) 的框架。</p>
<p>如何不用 <code>defineProperty</code> 实现 Reactivity：</p>
<ol>
<li>只要在每次赋值的时候，手动执行 <code>update</code> 方法</li>
<li>Svelte 在编译阶段自动帮我们做了这件事</li>
<li>Svelte 使用了一个 <code>label</code> 语法（$:），实现类似于 Vue 的 <code>computed</code> 功能。</li>
</ol>
<p>Svelte 的跨组件通讯：</p>
<ul>
<li>通过在变量名前面加一个 $ 实现自动订阅<ul>
<li>不是黑魔法，只是针对 $ 开头的变量自动转换成 <code>subscribe</code></li>
</ul>
</li>
</ul>
<p>Svelte 所有功能都在编译阶段完成，并且可以写更少的代码，它相对于 React 和 Vue 更简单，不需要学太多额外的 API 和新语法。</p>
<p>目前的适用场景：</p>
<ul>
<li>适用做来做活动页。</li>
</ul>
<h5 id="我的启发"><a href="#我的启发" class="headerlink" title="我的启发"></a>我的启发</h5><p>学习一个框架或者一个语言，并不一定非要把它用到生产上才算真的有用。更多地是因为想看看在面对同一个问题的时候，不同的人解决问题的思路是怎样的，从而帮助我们提高自己的视野，这才是学习框架和语言真正的魅力。</p>
<h3 id="Svelte-的异步更新实现原理"><a href="#Svelte-的异步更新实现原理" class="headerlink" title="Svelte 的异步更新实现原理"></a><a target="_blank" rel="noopener" href="https://lutaonan.com/blog/how-svelte-set-state-works/">Svelte 的异步更新实现原理</a></h3><p><em>原文地址：<a target="_blank" rel="noopener" href="https://lutaonan.com/blog/how-svelte-set-state-works/">《Svelte 的异步更新实现原理》 | Randy’s Blog</a></em></p>
<p>如何异步更新：<strong>将所有导致 UI 更新的操作统一放到一个微任务里执行。</strong></p>
<p>Svelte 的实际做法：</p>
<ol>
<li>一个组件会被编译成一个 fragment</li>
<li>更新操作通过 <code>$$invalidate</code> 包裹</li>
<li>触发 <code>schedule_update()</code> ，通知框架需要被更新，框架会维护一个 <code>dirty_components</code> 数组。</li>
<li>在微任务更新时会统一遍历 <code>dirty_components</code> 数组里的任务，触发组件的更新方法。</li>
</ol>
<h3 id="开发模式-“Development-Mode”-是如何工作的？"><a href="#开发模式-“Development-Mode”-是如何工作的？" class="headerlink" title="开发模式 “Development Mode” 是如何工作的？"></a><a target="_blank" rel="noopener" href="https://overreacted.io/zh-hans/how-does-the-development-mode-work/">开发模式 “Development Mode” 是如何工作的？</a></h3><p><em>原文地址：<a target="_blank" rel="noopener" href="https://overreacted.io/zh-hans/how-does-the-development-mode-work/">《开发模式 “Development Mode” 是如何工作的？》 | Dan Abramov</a></em></p>
<p><code>process.env.NODE_ENV</code> 实际上是一个常量，在构建时会被替换成一个字符串，所以判断条件最终是：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">// In development:</span><br><span class="line"><span class="keyword">if</span> (<span class="string">&#x27;development&#x27;</span> !== <span class="string">&#x27;production&#x27;</span>) &#123; // <span class="literal">true</span></span><br><span class="line">  doSomethingDev(); // 👈</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">  doSomethingProd();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// In production:</span><br><span class="line"><span class="keyword">if</span> (<span class="string">&#x27;production&#x27;</span> !== <span class="string">&#x27;production&#x27;</span>) &#123; // <span class="literal">false</span></span><br><span class="line">  doSomethingDev();</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">  doSomethingProd(); // 👈</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>以上判断条件会被「死码消除」给优化，不被执行的代码将被移除。</p>
<p>但是，如果写成这样，则不会奏效：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">let</span> mode = <span class="string">&#x27;production&#x27;</span>;</span><br><span class="line"><span class="keyword">if</span> (mode !== <span class="string">&#x27;production&#x27;</span>) &#123;</span><br><span class="line">  // 🔴 not guaranteed to be eliminated</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>因为 JavaScript 并没有智能到这种程度。</p>
<h5 id="我的启发-1"><a href="#我的启发-1" class="headerlink" title="我的启发"></a>我的启发</h5><p>以前看 Vue 源码的时候发现很多文件都会重复好几次这样的代码：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (process.env.NODE_ENV !== <span class="string">&#x27;production&#x27;</span>) &#123;</span><br><span class="line">  <span class="keyword">if</span> (something) &#123;</span><br><span class="line">    <span class="built_in">console</span>.warn(<span class="string">&#x27;something error message&#x27;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>非常好奇为什么不重构成这样：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// utils.js</span></span><br><span class="line"><span class="keyword">const</span> warn = <span class="function">(<span class="params">condition, message</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (process.env.NODE_ENV !== <span class="string">&#x27;production&#x27;</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (condition) &#123;</span><br><span class="line">      <span class="built_in">console</span>.warn(message);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// something.js</span></span><br><span class="line">warn(xxx, <span class="string">&#x27;something error message&#x27;</span>);</span><br></pre></td></tr></table></figure>

<p>现在知道为什么了，因为前者被「死码消除」后，所有相关代码都会被移除，</p>
<p>而后者，相当于调用了一个空的 <code>warn</code> 方法。</p>
<p>但没想到在 Vue3 中已经这么做了：<a target="_blank" rel="noopener" href="https://github.com/vuejs/core/blob/main/packages/compiler-core/src/errors.ts#L16">defaultOnWarn</a>。</p>
<p>延伸阅读：<a target="_blank" rel="noopener" href="https://segmentfault.com/a/1190000041469096">高效实现框架和 JS 库瘦身</a></p>
<h3 id="通俗易懂的代数效应"><a href="#通俗易懂的代数效应" class="headerlink" title="通俗易懂的代数效应"></a><a target="_blank" rel="noopener" href="https://overreacted.io/zh-hans/algebraic-effects-for-the-rest-of-us/">通俗易懂的代数效应</a></h3><p><em>原文地址：<a target="_blank" rel="noopener" href="https://overreacted.io/zh-hans/algebraic-effects-for-the-rest-of-us/">《通俗易懂的代数效应》 | Dan Abramov</a></em></p>
<p>代数效应是什么：</p>
<ul>
<li>类似于 try…catch 语法，无论我们在多少层里面 throw 一个错误，外层的 catch 都能捕获到。</li>
<li>如果内层的 throw 还可以接受从 catch 发送的数据，这就是代数效应。</li>
<li>使用 async、await 的缺点是我们内部定义了 async、则会影响该函数底部所有的调用者。</li>
</ul>
<p>React 中的代数效应：</p>
<ul>
<li>JS 并没有一个类似于 try…handle 的语法，但仅在 React 内部可以通过其它方式实现类似的效果。</li>
<li>典型的场景是：某个组件的渲染是异步的，需要等数据请求返回后再回过来继续渲染。</li>
</ul>
<h3 id="防御性-CSS"><a href="#防御性-CSS" class="headerlink" title="防御性 CSS"></a><a target="_blank" rel="noopener" href="https://ishadeed.com/article/defensive-css/">防御性 CSS</a></h3><p><em>原文地址：<a target="_blank" rel="noopener" href="https://ishadeed.com/article/defensive-css/">《防御性 CSS》 | ishadeed</a></em></p>
<ol>
<li>确保 flex 布局能够换行</li>
<li>确保文字过长时的间距以及换行处理</li>
<li>防止图片被拉伸或压缩</li>
<li>弹窗锁定滚动</li>
<li>CSS 变量回退</li>
<li>尽量使用 min-height 固定宽度和高度</li>
<li>确保重置 <code>background-repeat</code></li>
<li>使用 <code>gap</code> 设置 flex 布局间距</li>
<li>给图片设置一个 background-color，以确保图片上方的文字能够正常显示</li>
<li>使用 <code>overflow: auto</code></li>
<li>图片 <code>object-fit: cover</code></li>
<li>分组选择器只要有一个无效，则所有选择器不生效</li>
</ol>
<h5 id="我的启发-2"><a href="#我的启发-2" class="headerlink" title="我的启发"></a>我的启发</h5><p>了解常用的防御性 CSS ，可以避免很多开发中没有意识到的问题。</p>
<h3 id="SSR、SSG、ISR、DPR-有什么区别？"><a href="#SSR、SSG、ISR、DPR-有什么区别？" class="headerlink" title="SSR、SSG、ISR、DPR 有什么区别？"></a><a target="_blank" rel="noopener" href="http://www.yyyweb.com/5407.html">SSR、SSG、ISR、DPR 有什么区别？</a></h3><p><em>原文地址：<a target="_blank" rel="noopener" href="http://www.yyyweb.com/5407.html">《SSR、SSG、ISR、DPR 有什么区别？》 | 前端里</a></em></p>
<ul>
<li>CSR（Client Side Rendering）: 客户端渲染<ul>
<li>缺点：SPA 应用不利于 SEO</li>
</ul>
</li>
<li>SSR（Server Side Rendering）: 服务端渲染<ul>
<li>优点：利于 SEO</li>
<li>缺点：需要更多的服务器计算资源和运维成本</li>
</ul>
</li>
<li>SSG（Static Site Generation）: 静态网站生成<ul>
<li>常年不变的直接生成为静态页面，页面中的动态内容使用 CSR</li>
<li>缺点：对于网页数量极多的页面，生成一次需要花费很长时间</li>
</ul>
</li>
<li>ISR（Incremental Site Rendering）: 增量式网站渲染<ul>
<li>关键性页面预渲染，缓存至 CDN；非关键性页面先显示 fallback，再使用 CSR渲染，并且缓存至 CDN</li>
<li>缺点：需要先显示 fallback 内容，用户体验不好</li>
</ul>
</li>
<li>DPR（Distributed Persistent Rendering）: 分布式持续渲染<ul>
<li>基于 ISR 的基础上去除 fallback，并且使用「按需构建器」来响应未渲染的页面</li>
</ul>
</li>
</ul>
<h3 id="不优雅的-React-Hooks"><a href="#不优雅的-React-Hooks" class="headerlink" title="不优雅的 React Hooks"></a><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/455317250">不优雅的 React Hooks</a></h3><p><em>原文地址：<a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/455317250">《不优雅的 React Hooks》 | 蚂蚁 RichLab 前端团队</a></em></p>
<p>「奇怪的」规矩：</p>
<ul>
<li>命名：react hooks 要求 hooks 命名以 use 开头，作者觉得破坏了语义，应该以 _ 或者 $ 开头</li>
<li>调用时序：react hooks 区分不同的 state 是通过 hooks 的调用顺序，在内部维护一个链表，这个做法是相对简单粗暴的，所以这就是为什么 hooks 不能条件分支中使用，作者认为这种要求完全需要依赖开发者的经验或者 lint 工具，并不符合直觉。</li>
<li>useRef 的「排除万难」：useRef 仅在组件 mount 阶段初始化，后面 update 时引用同一个变量，但是作者这样多少有点违反 react hooks 的设计初衷，也即 useRef 并不函数式。</li>
</ul>
<p>有缺陷的生命周期：</p>
<ul>
<li>构造时：Class Component 和 Function Component 之间存在一个很大的区别，那就是后者每次 re-render 时都在重新调用自身，所以它并没有 constructor 来做某些仅执行一次的操作。</li>
<li>设计混乱的 useEffect：它实际上只监听能够触发 re-render 的变量，也就是 state，但是它接受的参数 deps 又不做任何限制，很难不让人认为是设计缺陷。</li>
</ul>
<p>useCallback：</p>
<ul>
<li>性能问题？无限套娃✓：使用 useCallback 是为了解决每次渲染都会创建一个新的回调函数，从而导致重新渲染的问题，但是使用 useCallback 也会引发一个更大的问题，那就是当useCallback之前存在依赖关系时，它们的引用维护也变得复杂。调用某个函数时要小心翼翼，你需要考虑它有没有引用过时的问题，如有遗漏又没有将其加入依赖数组，就会产生 Bug。</li>
</ul>
<p>小结：</p>
<ul>
<li>本文没有鼓吹 Class Component 拒绝使用 React Hooks 的意思，反而是希望通过细致地比对二者，从而更深入理解 Hooks。</li>
<li>React Hooks 的各种奇怪之处，也正是潜在症结之所在。</li>
<li>在 Hooks 之前，Function Component 都是 Stateless 的，小巧、可靠但功能有限。Hooks 为 Function Component 赋予了 State 能力并提供了生命周期，使 Function Component 的大规模使用成为了可能。</li>
<li>Hooks 的「优雅」来自向函数式的致敬，但useRef的滥用让 Hooks 离「优雅」相去甚远。</li>
<li>大规模实践 React Hooks 仍然有诸多问题，无论是从语义理解抑或是封装的必要性。</li>
<li>创新不易，期待 React 官方之后会有更好的设计吧。</li>
</ul>
<h3 id="DevTools-实现原理"><a href="#DevTools-实现原理" class="headerlink" title="DevTools 实现原理"></a><a target="_blank" rel="noopener" href="https://mp.weixin.qq.com/s/H8iahg5WUOHXeRzvf0R01w?scene=25#wechat_redirect">DevTools 实现原理</a></h3><p><em>原文地址：<a target="_blank" rel="noopener" href="https://mp.weixin.qq.com/s/H8iahg5WUOHXeRzvf0R01w?scene=25#wechat_redirect">《DevTools 实现原理》 | vivo 互联网浏览器内核团队</a></em></p>
<p>DevTools 架构：</p>
<ul>
<li>Chrome：TCP + CDP<ul>
<li>CDP（Chrome DevTools Protocol） 本质上是一个 JSON 协议，目前使用 Puppeteer 实现</li>
</ul>
</li>
<li>使用 WebSocket</li>
<li>Android：利用 ADB forward 端口转发能力连接 PC 和 Android 的网络访问</li>
</ul>
<p>内核实现</p>
<ul>
<li>Server 层，用于接收外部网络发过来的操作请求。</li>
<li>Agent 层，对于 Server 层发过来的请求，进行拆解，根据操作的类型不同，再分发给不同的 Agent 来处理。</li>
<li>Session 层，Session 是对不同的业务模块进行了一层抽象。过了 Session 层后，将会进入不同的业务模块，可以到达 V8， Blink 等。</li>
<li>业务层，就是具体的功能模块，比如 V8 模块，主要负责 JavaScript 的调试相关能力的支撑。</li>
</ul>
<h2 id="有趣的链接"><a href="#有趣的链接" class="headerlink" title="有趣的链接"></a>有趣的链接</h2><ul>
<li><p><a target="_blank" rel="noopener" href="https://devtool.tech/tree">Tree 树形目录可视化生成器</a>：我们都知道 <code>tree</code> 这个命令，可以打印输出现有目录的树形结构，但现实中还存在一种情况，那就是需要输出并不存在的目录结构，这种需求在写开发设计文档时尤为常见，所以除了构造一个临时的目录，还可以使用这个工具直接生成树形目录结构。</p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://zh.z-lib.org/">Z-Library</a>：世界上最大的数字图书馆，在这里可以找到大量的电子书籍，格式包括：pdf、epub、mobi 等，对于我这种不爱看实体书的人来说，简直是神器。但需要注意每天一个 ip 会限制下载数量，未注册用户是 5 次，注册用户是 10 次，当然也可以通过捐赠来提高下载次数的限制。</p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://www.iizhi.cn/">毕方铺</a>：网盘搜索神器，个人认为是所有网盘搜索神器中最好的一个，所有资源都为用户自愿分享，下载需要耗费金币，你也可以上传你想要的分享的资源，别人购买你就能获取金币，当然到达一定金币后就可以提现。</p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://createfeed.fivefilters.org/index-mergefeeds.php?url%5B%5D=https://medium.com/feed/tag/open-source&max=20&order=feed">Feed Creator</a>：制作 RSS 源的工具，包括网页生成 RSS、合并多个 RSS 等功能；相信有些同学知道 <a target="_blank" rel="noopener" href="https://docs.rsshub.app/">RSSHub</a> 这个开源项目，显然这个项目更加强大，但并不是所有场景都需要用到 RSSHub，这时候就可以使用 Feed Creator。分享一下我个人会在什么场景下使用 Feed Creator 而不是 RSSHub：对于某些访问需要科学上网的网站，我们可以直接通过它生成一个国内可以直接访问的 RSS 源。</p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://docs.microsoft.com/zh-cn/learn/paths/rust-first-steps/">Microsoft 的 Rust 入门教程</a>：要说这两年前端最新的技术莫过于 Rust 了，大量的前端基础设施都通过 Rust 重写了一遍，哪怕笔者这种学不动的人也需要学一些 Rust 的知识，但无奈一直没有找到满意的 Rust 教程，前段时间听闻微软出了一个 Rust 教程，第一次打开后就直接跟着学了两个星期，根本停不下来，真心不错。xdm，Rust 学起来吧！</p>
</li>
</ul>
</div>
  <hr class="copy-line" />
  <div class="post-copyright">
    <div class="copy-author">
      <span>作者 :</span>
      <span
        >4Ark</span
      >
    </div>
    <div class="copy-url">
      <span>地址 :</span>
      <a href="https://4ark.me/post/weekly-01.html">https://4ark.me/post/weekly-01.html</a>
    </div>
    <div class="copy-origin">
      <span>来源 :</span>
      <a href="https://4ark.me">https://4ark.me</a>
    </div>
    <div class="copy-license">著作权归作者所有，转载请联系作者获得授权。</div>
  </div>
</article>

<div class="blog-post-comments">
  <div id="load-disqus">
    <p onclick="loadDisqus()" style="cursor: pointer; text-align: center">
      🥳&nbsp;加载 Disqus 评论
    </p>
  </div>
  <div id="disqus_thread">
    <noscript>Please enable JavaScript to view the comments.</noscript>
  </div>
</div>
 


        
          <div id="footer-post-container">
  <div id="footer-post">

    <div id="nav-footer" style="display: none">
      <ul>
         
          <li><a href="/">Home</a></li>
         
          <li><a href="/about">About</a></li>
         
          <li><a href="/archives">Writing</a></li>
         
          <li><a href="/weekly">Weekly</a></li>
         
          <li><a href="/tags">Tags</a></li>
         
          <li><a href="/search">Search</a></li>
        
      </ul>
    </div>

    <div id="toc-footer" style="display: none">
      <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%88%91%E4%B8%BA%E4%BB%80%E4%B9%88%E8%A6%81%E5%86%99%E5%91%A8%E5%88%8A"><span class="toc-number">1.</span> <span class="toc-text">我为什么要写周刊</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%88%91%E6%90%AC%E6%96%B0%E5%AE%B6%E4%BA%86"><span class="toc-number">2.</span> <span class="toc-text">我搬新家了</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%86%E4%BA%AB%E6%96%87%E7%AB%A0"><span class="toc-number">3.</span> <span class="toc-text">分享文章</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%88%91%E5%AF%B9-Svelte-%E7%9A%84%E7%9C%8B%E6%B3%95"><span class="toc-number">3.1.</span> <span class="toc-text">我对 Svelte 的看法</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%88%91%E7%9A%84%E5%90%AF%E5%8F%91"><span class="toc-number">3.1.0.1.</span> <span class="toc-text">我的启发</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Svelte-%E7%9A%84%E5%BC%82%E6%AD%A5%E6%9B%B4%E6%96%B0%E5%AE%9E%E7%8E%B0%E5%8E%9F%E7%90%86"><span class="toc-number">3.2.</span> <span class="toc-text">Svelte 的异步更新实现原理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BC%80%E5%8F%91%E6%A8%A1%E5%BC%8F-%E2%80%9CDevelopment-Mode%E2%80%9D-%E6%98%AF%E5%A6%82%E4%BD%95%E5%B7%A5%E4%BD%9C%E7%9A%84%EF%BC%9F"><span class="toc-number">3.3.</span> <span class="toc-text">开发模式 “Development Mode” 是如何工作的？</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%88%91%E7%9A%84%E5%90%AF%E5%8F%91-1"><span class="toc-number">3.3.0.1.</span> <span class="toc-text">我的启发</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%80%9A%E4%BF%97%E6%98%93%E6%87%82%E7%9A%84%E4%BB%A3%E6%95%B0%E6%95%88%E5%BA%94"><span class="toc-number">3.4.</span> <span class="toc-text">通俗易懂的代数效应</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%98%B2%E5%BE%A1%E6%80%A7-CSS"><span class="toc-number">3.5.</span> <span class="toc-text">防御性 CSS</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%88%91%E7%9A%84%E5%90%AF%E5%8F%91-2"><span class="toc-number">3.5.0.1.</span> <span class="toc-text">我的启发</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#SSR%E3%80%81SSG%E3%80%81ISR%E3%80%81DPR-%E6%9C%89%E4%BB%80%E4%B9%88%E5%8C%BA%E5%88%AB%EF%BC%9F"><span class="toc-number">3.6.</span> <span class="toc-text">SSR、SSG、ISR、DPR 有什么区别？</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%8D%E4%BC%98%E9%9B%85%E7%9A%84-React-Hooks"><span class="toc-number">3.7.</span> <span class="toc-text">不优雅的 React Hooks</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#DevTools-%E5%AE%9E%E7%8E%B0%E5%8E%9F%E7%90%86"><span class="toc-number">3.8.</span> <span class="toc-text">DevTools 实现原理</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9C%89%E8%B6%A3%E7%9A%84%E9%93%BE%E6%8E%A5"><span class="toc-number">4.</span> <span class="toc-text">有趣的链接</span></a></li></ol>
    </div>

    <div id="share-footer" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=https://4ark.me/post/weekly-01.html"><i class="fab fa-facebook fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=https://4ark.me/post/weekly-01.html&text=周刊第1期：搬新家了"><i class="fab fa-twitter fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=https://4ark.me/post/weekly-01.html&title=周刊第1期：搬新家了"><i class="fab fa-linkedin fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=https://4ark.me/post/weekly-01.html&is_video=false&description=周刊第1期：搬新家了"><i class="fab fa-pinterest fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=周刊第1期：搬新家了&body=Check out this article: https://4ark.me/post/weekly-01.html"><i class="fas fa-envelope fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=https://4ark.me/post/weekly-01.html&title=周刊第1期：搬新家了"><i class="fab fa-get-pocket fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=https://4ark.me/post/weekly-01.html&title=周刊第1期：搬新家了"><i class="fab fa-reddit fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=https://4ark.me/post/weekly-01.html&title=周刊第1期：搬新家了"><i class="fab fa-stumbleupon fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=https://4ark.me/post/weekly-01.html&title=周刊第1期：搬新家了"><i class="fab fa-digg fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=https://4ark.me/post/weekly-01.html&name=周刊第1期：搬新家了&description="><i class="fab fa-tumblr fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://news.ycombinator.com/submitlink?u=https://4ark.me/post/weekly-01.html&t=周刊第1期：搬新家了"><i class="fab fa-hacker-news fa-lg" aria-hidden="true"></i></a></li>
</ul>

    </div>

    <div id="actions-footer">
        <a id="dark-mobile" class="icon"><i class="fa fa-sun" id="dark-btn" aria-hidden="true"></i> Switch</a>
        <a id="menu" class="icon" href="#" onclick="$('#nav-footer').toggle();return false;"><i class="fas fa-bars fa-lg" aria-hidden="true"></i> Menu</a>
        <a id="toc" class="icon" href="#" onclick="$('#toc-footer').toggle();return false;"><i class="fas fa-list fa-lg" aria-hidden="true"></i> TOC</a>
        <a id="share" class="icon" href="#" onclick="$('#share-footer').toggle();return false;"><i class="fas fa-share-alt fa-lg" aria-hidden="true"></i> Share</a>
        <a id="top" style="display:none" class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fas fa-chevron-up fa-lg" aria-hidden="true"></i> Top</a>
    </div>

  </div>
</div>

        
        <footer id="footer">
  <div class="footer-left">
    Copyright &copy;
    
    
    2016-2024
    4Ark
  </div>
  <div class="footer-right">
    <nav>
      <ul>
        <!--
       --><li><a href="/">Home</a></li><!--
     --><!--
       --><li><a href="/about">About</a></li><!--
     --><!--
       --><li><a href="/archives">Writing</a></li><!--
     --><!--
       --><li><a href="/weekly">Weekly</a></li><!--
     --><!--
       --><li><a href="/tags">Tags</a></li><!--
     --><!--
       --><li><a href="/search">Search</a></li><!--
     -->
      </ul>
    </nav>
  </div>
</footer>

    </div>
    <!-- styles -->



  <link rel="preload" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.2/css/all.min.css" crossorigin="anonymous" onload="this.onload=null;this.rel='stylesheet'"/>


    <!-- jquery -->
 
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js" crossorigin="anonymous"></script> 




<!-- clipboard -->

  
    <script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.7/clipboard.min.js" crossorigin="anonymous"></script> 
  
  <script type="text/javascript">
  $(function() {
    // copy-btn HTML
    var btn = "<span class=\"btn-copy tooltipped tooltipped-sw\" aria-label=\"Copy to clipboard!\">";
    btn += '<i class="far fa-clone"></i>';
    btn += '</span>'; 
    // mount it!
    $(".highlight table").before(btn);
    var clip = new ClipboardJS('.btn-copy', {
      text: function(trigger) {
        return Array.from(trigger.nextElementSibling.querySelectorAll('.code')).reduce((str,it)=>str+it.innerText+'\n','')
      }
    });
    clip.on('success', function(e) {
      e.trigger.setAttribute('aria-label', "Copied!");
      e.clearSelection();
    })
  })
  </script>


<script src="/js/main.js"></script>

<!-- search -->

<!-- Google Analytics -->

    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-190615898-1"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'UA-190615898-1');
    </script>

<!-- Baidu Analytics -->

<!-- Cloudflare Analytics -->

<!-- Umami Analytics -->

<!-- Disqus Comments -->

<script type="text/javascript">
  function loadDisqus() {
    var disqus_shortname = 'https-4ark-me'

    ;(function () {
      var dsq = document.createElement('script')
      dsq.type = 'text/javascript'
      dsq.async = true
      dsq.src =
        '//' +
        disqus_shortname +
        '.disqus.com/embed.js'
      ;(
        document.getElementsByTagName('head')[0] ||
        document.getElementsByTagName('body')[0]
      ).appendChild(dsq)
    })()

    $('#load-disqus').hide()
  }
</script>

<!-- utterances Comments -->

</body>
</html>
