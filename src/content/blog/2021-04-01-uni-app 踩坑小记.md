---
title: uni-app è¸©å‘å°è®°
pubDatetime: 2021-04-01
permalinks:
  - /post/uni-app-issues.html
  - /post/uni-app-issues
tags:
  - å‰ç«¯
  - å°ç¨‹åº
  - uni-app
---

## å†™åœ¨å‰é¢

è¿™é‡Œè®°å½•ä¸€äº›ä½¿ç”¨ uni-app å’Œ uView å¼€å‘æ—¶è¸©è¿‡çš„å‘ï¼Œå¸Œæœ›èƒ½å¯¹åæ¥è€…æœ‰æ‰€å¸®åŠ©ã€‚

## 1. å¾®ä¿¡å¼€å‘è€…å·¥å…·å…³é—­ ES6 è½¬ ES5

å¦‚æœå¾®ä¿¡å¼€å‘è€…å·¥å…·å¼€å¯äº† ES6 è½¬ ES5 çš„åŠŸèƒ½ï¼Œä¼šå¯¼è‡´å¼•å…¥çš„ uView ç»„ä»¶æ— æ³•æ­£å¸¸ä½¿ç”¨ï¼Œä¼šæŠ¥ç±»ä¼¼äºä¸‹é¢è¿™æ ·çš„é”™ï¼š

![](https://gd4ark-1258805822.cos.ap-guangzhou.myqcloud.com/images/20210728092428.png)

è§£å†³æ–¹æ¡ˆï¼šæŠŠå¾®ä¿¡å¼€å‘è€…å·¥å…·çš„ ES6 è½¬ ES5 åŠŸèƒ½å…³æ‰ï¼Œè®¾ç½® -> é¡¹ç›®è®¾ç½® -> æœ¬åœ°è®¾ç½®ã€‚

## 2. ref ä¸è¦æ”¾åœ¨ computed

ä¸‹é¢è¿™ä»½ä»£ç ï¼Œåœ¨å°ç¨‹åºç«¯è¿è¡Œå¼‚å¸¸ï¼š

```html
<template>
  <view class="container">
    <button ref="button">button</button>
  </view>
</template>

<script>
  export default {
    computed: {
      buttonRef() {
        return this.$refs.button;
      },
    },

    mounted() {
      this.buttonRef.someMethods(); // åœ¨ mp-weixin ä¼šæŠ¥ï¼šbuttonRef ä¸ºç©º
    },
  };
</script>
```

è§£å†³æ–¹æ¡ˆï¼šä¸è¦æŠŠ refs çš„å®šä¹‰æ”¾åœ¨ computedï¼Œæ¯æ¬¡ä½¿ç”¨éƒ½ç›´æ¥é€šè¿‡ `this.$refs.button` è·å– ã€‚

## 3. å°ç¨‹åºç«¯çš„ç»„ä»¶æ ·å¼é—®é¢˜

æœ‰å¯èƒ½ä½ åœ¨ h5 ç¼–å†™å¥½ä¸€ä¸ªç»„ä»¶çš„æ ·å¼ï¼Œè¿è¡Œå¥½å¥½çš„ï¼Œç»“æœåœ¨å°ç¨‹åºç«¯å´ä¸æ­£å¸¸äº†ï¼ŒåŸå› åœ¨äºå°ç¨‹åºç«¯ä¼šåœ¨ç»„ä»¶å¤–é¢å¤–å¢åŠ ä¸€å±‚è§†å›¾å®¹å™¨ï¼Œè¿™å¯èƒ½ä¼šå¯¼è‡´è¯¸å¦‚ä¸€äº›é«˜åº¦ã€å¤–è¾¹è·ä¹‹ç±»çš„æ ·å¼å¤±æ•ˆï¼Œè§£å†³æ–¹æ¡ˆå°±æ˜¯ä¿®æ”¹è¿™ä¸ªå¤–å±‚çš„æ ·å¼ï¼Œä½¿å®ƒä¸æˆ‘ä»¬è¿™ä¸ªç»„ä»¶çš„æœ€å¤–å±‚æ ·å¼ä¸€è‡´ï¼š

```html
<style lang="scss">
  // #ifdef MP-WEIXIN
  // HACk: å¾®ä¿¡å°ç¨‹åºç«¯ç»„ä»¶å¤–é¢ä¼šå¤šä¸€å±‚ï¼Œéœ€è¦ç»™å®ƒä¹Ÿè®¾ç½®é«˜åº¦
  [data-ref='basicLayout'], // è¿™é‡Œçš„å€¼åœ¨å¾®ä¿¡å¼€å‘è€…å·¥å…·æŸ¥çœ‹
// #endif
.basic-layout,
.page-content {
    flex: 1;
    display: flex;
    flex-direction: column;
  }
</style>
```

æ³¨æ„ï¼šç”±äºè¿™ä¸ªé€‰æ‹©å™¨åªé’ˆå¯¹å°ç¨‹åºç«¯ï¼Œæ‰€ä»¥æˆ‘ä»¬è¦åŠ ä¸€ä¸ªæ¡ä»¶æ¸²æŸ“ã€‚

## 4. å°ç¨‹åºç«¯ä¿®æ”¹çš„å¤–éƒ¨ç»„ä»¶æ ·å¼æ— æ•ˆçš„é—®é¢˜

### é—®é¢˜æè¿°

å¦‚æœè¦åœ¨ `.vue ` ä¸­ä¿®æ”¹å¤–éƒ¨ç»„ä»¶çš„æ ·å¼ï¼ˆå¦‚ uni-app å’Œ uViewï¼‰ï¼Œåƒä¸‹é¢è¿™æ ·å¯èƒ½ä¼šæ— æ•ˆï¼š

```html
<template>
  <view class="container">
    <u-search v-model="keyword" placeholder="æ—¥ç…§é¦™ç‚‰ç”Ÿç´«çƒŸ"></u-search>
  </view>
</template>

<script>
  export default {
    data() {
      return {
        keyword: "",
      };
    },
  };
</script>

<style lang="scss">
  .container {
    .u-search .u-input {
      color: red !important;
    }
  }
</style>
```

è¿è¡Œç»“æœï¼š

![](https://gd4ark-1258805822.cos.ap-guangzhou.myqcloud.com/images/20210728092634.png)
![](https://gd4ark-1258805822.cos.ap-guangzhou.myqcloud.com/images/20210728092644.png)

#### è§£å†³æ–¹æ¡ˆ

è¿™æ˜¯å› ä¸ºåœ¨ uni-app `<style>` Â  é»˜è®¤éƒ½æ˜¯ `scope` çš„ï¼Œæ‰€ä»¥éœ€è¦æ”¹æˆä¸‹é¢è¿™æ ·ï¼š

```diff
<style lang="scss">
.container {
-  .u-search .u-input {
+  /deep/ .u-search .u-input {
    color: red !important;
  }
}
</style>
```

è¿™æ · H5 ä¹Ÿèƒ½è¿è¡Œæ­£å¸¸äº†ï¼š

![](https://gd4ark-1258805822.cos.ap-guangzhou.myqcloud.com/images/20210728092659.png)

### å°ç¨‹åºç«¯ä¿®æ”¹ shadow-root å†…éƒ¨æ ·å¼

ä½†æ˜¯è¿˜æœ‰ä¸€ç§æƒ…å†µï¼Œå°±æ˜¯å¦‚æœä½ è¦ä¿®æ”¹çš„ç»„ä»¶ä½äº `#shadow-root` ä¸‹ï¼Œå°±æœ‰å¯èƒ½æ— æ³•ä¿®æ”¹ï¼Œæ¯”å¦‚ä¸‹é¢è¿™æ ·ï¼š

```css
.nav-bar {
  /deep/ .uni-navbar__content {
    overflow: unset !important;
  }
}
```

å…¶å®æ ¹æœ¬æ²¡æœ‰ä¿®æ”¹åˆ°ï¼š

![](https://gd4ark-1258805822.cos.ap-guangzhou.myqcloud.com/images/20210728094252.png)

#### è§£å†³æ–¹æ¡ˆ

è¿™ç§æƒ…å†µï¼Œæˆ‘ä»¬å¿…é¡»åœ¨ `App.vue` ä¸‹çš„ `<style>` æ‰èƒ½è¿›è¡Œæ ·å¼è¦†ç›–ï¼Œä½†ä¸ºäº†æ–¹ä¾¿ç»´æŠ¤ï¼Œæˆ‘ä»¬æ–°å¢äº†ä¸€ä¸ª `uni-custom-app.scss` ä¸“é—¨åšè¿™ä»¶äº‹ï¼Œç”¨äºè§£å†³ä¸Šé¢è¿™ç§æƒ…å†µï¼š

```css
// æ–‡ä»¶è·¯å¾„ï¼šsrc/styles/uni-custom.scss

/**
* è¿™ä¸ªæ–‡ä»¶ç”¨äºä¿®æ”¹ uni æˆ–è€…å…¶ä»– ui ç»„ä»¶åº“çš„æ ·å¼
* ç”±äºå¾®ä¿¡å°ç¨‹åºçš„é™åˆ¶ï¼Œæ— æ³•åœ¨ç»„ä»¶å†…éƒ¨ä¿®æ”¹å…¶ä»–å¤–éƒ¨ç»„ä»¶çš„æ ·å¼ï¼Œåªèƒ½åœ¨å…¨å±€è®¾ç½®
* @link https://ask.dcloud.net.cn/question/68411
*
* æ³¨æ„ï¼šå¦‚æœä¸æ˜¯å…¨å±€ä¿®æ”¹ï¼Œä¸ºé¿å…å½±å“å…¶å®ƒï¼Œéœ€è¦æŒ‡å®šåœ¨å¤–å±‚é¡µé¢å’Œç»„ä»¶
*/

// å…¨å±€ä¿®æ”¹
// .u-btn {
//   color: red;
// }

// å±€éƒ¨ä¿®æ”¹
// .page-xxx {
//   .container {
//     .u-btn {
//       color: red;
//     }
//   }
// }
```

ä¹Ÿå°±æ˜¯è¯´ï¼Œæˆ‘ä»¬åªè¦æŠŠä¸Šé¢çš„æ ·å¼ç§»åŠ¨åˆ°è¿™ä¸ªæ–‡ä»¶å³å¯ï¼š

```diff
// æ–‡ä»¶è·¯å¾„ï¼šsrc/styles/uni-custom.scss

...

+.page-message {
+  .nav-bar {
+    /deep/ .uni-navbar__content {
+      overflow: unset !important;
+    }
+  }
+}
```

å¯ä»¥çœ‹åˆ°æ˜¯æœ‰æ ·å¼çš„ï¼š

![](https://gd4ark-1258805822.cos.ap-guangzhou.myqcloud.com/images/20210728100012.png)

ä½†æ˜¯ä½ ä¼šçœ‹åˆ°æˆ‘ä»¬å†™çš„æ ·å¼æƒé‡ä¼¼ä¹ä¸å¤Ÿé«˜ï¼Œä½†å…¶å®æ ·å¼å·²ç»è¢«åº”ç”¨ä¸Šå»äº†ï¼Œæ‰€ä»¥ä¸ç”¨åœ¨æ„è¿™é‡Œï¼Œè‡³äºä¸ºä»€ä¹ˆä¼šè¿™æ ·ï¼Œå¯èƒ½ä¼šå¾®ä¿¡å¼€å‘è€…å·¥å…·çš„é—®é¢˜å§ï¼Ÿ

æ³¨æ„ï¼šå¦‚æœæ­¤æ ·å¼åªé’ˆå¯¹æŸä¸ªé¡µé¢ä¸‹çš„ç»„ä»¶ï¼Œå»ºè®®åœ¨å¤–é¢åŒ…ä¸€å±‚è¯¥é¡µé¢çš„å”¯ä¸€ class åå­—ï¼Œä»¥é˜²å½±å“å…¶å®ƒé¡µé¢ã€‚

å‚è€ƒé“¾æ¥ï¼š[https://ask.dcloud.net.cn/question/68411](https://ask.dcloud.net.cn/question/68411)

å¦‚æœæ˜¯è‡ªå®šä¹‰ uButton æ ·å¼æ— æ•ˆï¼Œå¯ä»¥çœ‹çœ‹ï¼š[18. è‡ªå®šä¹‰ uButton æ ·å¼](

## 5. åœ¨ HBuilder è¿è¡Œé¡¹ç›®

ç”±äºæˆ‘ä»¬æ˜¯ä½¿ç”¨ cli çš„æ–¹å¼ç”Ÿæˆçš„é¡¹ç›®ï¼Œæ‰€ä»¥åŸºæœ¬å¼€å‘åªéœ€è¦åœ¨å‘½ä»¤è¡Œè¿è¡Œ `npm run dev:xxx` å³å¯ï¼Œä½†æ˜¯å¦‚æœè¦è°ƒè¯• APP ç«¯ï¼Œè¿˜æ˜¯ä½¿ç”¨ HBuilder è¦æ›´æ–¹ä¾¿ï¼Œç„¶è€Œå¦‚æœåœ¨ åœ¨ HBuilder è¿è¡Œ cli é¡¹ç›® ä½ å¯èƒ½ä¼šé‡åˆ°ä»¥ä¸‹é”™è¯¯ï¼š

```bash
Node Sass could not find a binding for your current environment: OS X 64-bit with Node.js 8.x
```

è¯´ç™½å°±æ˜¯ node-sass å‡ºäº†é—®é¢˜äº†ï¼ŒHBuilder é»˜è®¤ä½¿ç”¨çš„ Node ç‰ˆæœ¬æ˜¯ v8.xï¼Œæ‰€ä»¥æˆ‘ä»¬è¦ä¿®æ”¹ä¸€ä¸‹é…ç½®ï¼Œè®©å®ƒä½¿ç”¨æˆ‘ä»¬æœ¬æœºçš„ Node ç‰ˆæœ¬ã€‚

åœ¨ åå¥½è®¾ç½® -> è¿è¡Œé…ç½® ä¸­ä¿®æ”¹ npm å’Œ Node çš„è·¯å¾„å³å¯ï¼š

![](https://gd4ark-1258805822.cos.ap-guangzhou.myqcloud.com/images/20210728100327.png)

å¦‚æœä½ ä¸çŸ¥é“ Node çš„è·¯å¾„åœ¨å“ªï¼Œå¯ä»¥è¿™æ ·ï¼š

- Linux/Macï¼š `where node`
- Windowsï¼šç›´æ¥çœ‹ç³»ç»Ÿç¯å¢ƒå˜é‡

å‚è€ƒï¼š[https://ask.dcloud.net.cn/question/67852](https://ask.dcloud.net.cn/question/67852)

## 6. åŠ¨æ€æ’æ§½å

### å‰è¨€

è¦åœ¨ uni-app ä¸­ä½¿ç”¨åŠ¨æ€ slot åå­—ï¼Œä¼šæ¯”è¾ƒéº»çƒ¦ï¼Œå› ä¸ºï¼šåœ¨ MP-WEIXINã€APP-PLUS éƒ½ä¼šæœ‰å‘ã€‚

### H5 å’Œ å°ç¨‹åºç«¯

æˆ‘ä»¬å…ˆè¯´æ¯”è¾ƒå¸¸ç”¨çš„ H5 å’Œ MP-WEIXIN å¥½äº†ï¼š

å®šä¹‰ï¼š

```html
<!-- HACK: uni-app å¤„ç†åŠ¨æ€ slot åå­—ä¸å…¼å®¹ï¼Œéœ€è¦ä½¿ç”¨ä¸åŒçš„è¯­æ³• -->
<!-- #ifdef H5 -->
<slot :name="`tab:${item.key}`"></slot>
<!-- #endif -->
<!-- #ifdef MP-WEIXIN-->
<slot name="tab:{{item.key}}"></slot>
<!-- #endif -->
```

ä½¿ç”¨ slotï¼š

```html
<view>
  <!-- HACK: uni-app å¤„ç†åŠ¨æ€ slot åå­—ä¸å…¼å®¹ï¼Œéœ€è¦ä½¿ç”¨ä¸åŒçš„è¯­æ³• -->
  <!-- #ifdef H5 -->
  <template v-for="item in list" :slot="`tab:${item.id}`">
    <post-list :key="item.id" />
  </template>
  <!-- #endif -->

  <!-- #ifdef MP-WEIXIN-->
  <template v-for="item in lits" slot="tab:professional:{{item.id}}">
    <post-list :key="item.id" />
  </template>
  <!-- #endif  -->
</view>
```

å‚è€ƒé“¾æ¥ï¼š[https://ask.dcloud.net.cn/question/82506](https://ask.dcloud.net.cn/question/82506)

### APP ç«¯

å¦‚æœè¿˜è¦å…¼å®¹ APP ç«¯ï¼ˆvue æ–‡ä»¶ï¼‰ï¼Œåˆ™æƒ…å†µä¼šå˜å¾—ç¨å¾®å¤æ‚ä¸€ç‚¹ï¼Œä»¥ä¸Šä¸¤ç§æƒ…å†µéƒ½ä¸é€‚ç”¨ï¼Œå…ˆè¯´ç»“è®ºï¼š

1. **ä¸æ”¯æŒæ‹¿ data çš„æ•°æ®ç”¨äºæ‹¼æ¥åŠ¨æ€ slot åå­—**
1. **åœ¨ v-for ä¸­è¦æ ¹æ®å½“å‰é¡¹çš„å­—æ®µæ¥æ‹¼æ¥ slot åå­—ï¼Œåˆ™è¦å°† key æŒ‡å‘ `item`Â  æœ¬èº«ï¼ˆä¸æ¨è**
1. **èƒ½æ‹¿ v-for çš„ index æ¥æ‹¼æ¥ slot åå­—ï¼ˆæ¨è**

#### è§£å†³æ–¹æ¡ˆ

ä¹Ÿå³ï¼Œå¦‚æœæ˜¯ä¸Šé¢çš„ä¾‹å­ï¼Œéœ€è¦æ”¹å†™ä¸ºå¦‚ä¸‹ï¼šï¼š

```html
<swiper-item v-for="(item, index) in tabs" :key="item.id" class="swiper-item">
  <!-- HACK: uni-app å¤„ç†åŠ¨æ€ slot åå­—ä¸å…¼å®¹ï¼Œéœ€è¦ä½¿ç”¨ä¸åŒçš„è¯­æ³• -->
  <!-- #ifdef H5 || APP-PLUS -->
  <slot :name="`tab:${index}`"></slot>
  <!-- #endif -->
  <!-- #ifdef MP-WEIXIN-->
  <slot name="tab:{{index}}"></slot>
  <!-- #endif -->
</swiper-item>
```

ä½¿ç”¨çš„æ—¶å€™ï¼š

```html
<tab-swiper
  ref="tabSwiper"
  :tabs="list"
  :current.sync="current"
  :swiper-current.sync="swiperCurrent"
>
  <!-- HACK: uni-app å¤„ç†åŠ¨æ€ slot åå­—ä¸å…¼å®¹ï¼Œéœ€è¦ä½¿ç”¨ä¸åŒçš„è¯­æ³• -->
  <!-- #ifndef H5 || APP-PLUS -->
  <template v-for="(item, index) in list" :slot="`tab:${index}`">
    <post-list :key="item.id" :stagger="index % 2 !== 0" />
  </template>
  <!-- #endif -->

  <!-- #ifdef MP-WEIXIN-->
  <template v-for="(item, index) in list" slot="tab:{{item.id}}">
    <post-list :key="item.id" :stagger="index % 2 !== 0" />
  </template>
  <!-- #endif  -->
</tab-swiper>
```

#### æ’æŸ¥é—®é¢˜

ä¸‹é¢å¼€å§‹æ’æŸ¥é—®é¢˜ï¼Œé¦–å…ˆæˆ‘ä»¬ç”¨ä»¥ä¸‹ä»£ç æµ‹è¯•ç”¨ data çš„æ•°æ®æ¥ä½œä¸º slot åå­—ï¼š

```html
<template>
  <view>
    testing dynamic slot
    <slot :name="key"></slot>
    <view :class="key"> test key value </view>
  </view>
</template>

<script>
  export default {
    data() {
      return {
        key: "slot-1",
      };
    },
  };
</script>
```

ç„¶åä½¿ç”¨å‘½ä»¤è¡Œæˆ–è€… HBuilderx ç¼–è¯‘ APP ç«¯ä»£ç åï¼Œæˆ‘ä»¬åœ¨ `dist/dev/app-plus/app-view.js`

æœç´¢ `testing dynamic slot` ï¼Œç„¶åå¯ä»¥çœ‹åˆ°ä»¥ä¸‹ä»£ç ï¼š

![](https://gd4ark-1258805822.cos.ap-guangzhou.myqcloud.com/images/20210728093109.png)
å¯ä»¥çœ‹åˆ°ï¼Œå³ä¾¿åŒæ ·ä½¿ç”¨äº† key ä½œä¸ºå±æ€§ï¼Œä½†å®ƒä»¬ç¼–è¯‘åçš„ä»£ç æ˜¯ä¸ä¸€æ ·çš„ï¼Œslot èŠ‚ç‚¹ç›´æ¥ä½¿ç”¨ `_vm._key` ï¼Œè€Œ view èŠ‚ç‚¹å˜æˆäº† `_vm._$(2,'c')` ï¼Œç”±æ­¤ä¹Ÿæ¨æ–­å‡º uni-app å†…éƒ¨å¹¶æ²¡æœ‰å¯¹ slot çš„ `name` å±æ€§åšé¢å¤–å¤„ç†ï¼Œå…¶å®å¦‚æœæ‰“å° `_vm.key` çš„å€¼ï¼Œ ä¼šå‘ç°æ˜¯ç©ºçš„ï¼š

![](https://gd4ark-1258805822.cos.ap-guangzhou.myqcloud.com/images/20210728093132.png)

**æ‰€ä»¥ç»“è®ºä¸€ï¼šä¸æ”¯æŒæ‹¿ data çš„æ•°æ®ç”¨äºæ‹¼æ¥åŠ¨æ€ slot åå­—ã€‚**

ä½†ç›´æ¥æ‹¿ data æ•°æ®æ¥æ‹¼æ¥ slot åå­—çš„æƒ…å†µæ¯”è¾ƒå°‘ï¼Œæ›´å¤šæ—¶å€™æ˜¯åœ¨ v-for å¾ªç¯å†…éƒ¨ï¼Œæ‰€ä»¥æˆ‘ä»¬å†æ‹¿ä»¥ä¸‹ä»£ç åšæµ‹è¯•ï¼š

```html
<template>
  <view>
    testing dynamic slot
    <view v-for="item in list" :key="item.id">
      {{ item.name }}
      <slot :name="`tab:${item.id}`"></slot>
    </view>
  </view>
</template>

<script>
  export default {
    data() {
      return {
        list: [
          {
            id: "a",
            name: "item-a",
          },
          {
            id: "b",
            name: "item-b",
          },
          {
            id: "c",
            name: "item-c",
          },
        ],
      };
    },
  };
</script>
```

ä»¥ä¸Šä»£ç åœ¨ APP ç«¯ä¾ç„¶æ˜¯ä¸æ­£å¸¸çš„ï¼Œæˆ‘ä»¬çœ‹çœ‹ç¼–è¯‘åçš„ä»£ç ï¼š

![](https://gd4ark-1258805822.cos.ap-guangzhou.myqcloud.com/images/20210728093202.png)

ä»£ç çœ‹ä¸Šå»å¥½åƒæŒºæ­£å¸¸çš„æ˜¯å§ï¼Œä½†æœ‰ä¸€ç‚¹å¾ˆå¥‡æ€ªï¼šä¸ºä»€ä¹ˆ key ç›´æ¥æŒ‡å‘äº† `item` ï¼Ÿ

æœä¸å…¶ç„¶ï¼Œæ‰“å° `item` å‘ç°è¿™é‡Œçš„ `item` å¹¶ä¸æ˜¯ v-for ä¸­çš„é‚£ä¸ª `item` å¯¹è±¡ ï¼Œè€Œæ˜¯ç”¨äºæŒ‡å®š `key` çš„å€¼ï¼š

![](https://gd4ark-1258805822.cos.ap-guangzhou.myqcloud.com/images/20210728093223.png)

æ‰€ä»¥ `item.id` ä¾ç„¶æ˜¯ç©ºçš„ï¼Œå®é™…ä¸Šè¿™é‡Œçš„ `item` === å¤–éƒ¨çš„ `item.id` ã€‚

æ—¢ç„¶å¦‚æ­¤ï¼Œæˆ‘ä»¬ä¼¼ä¹å¾—åˆ°ä¸¤ä¸ªè§£å†³æ–¹æ¡ˆï¼š

1. å°† v-for çš„ key ç›´æ¥æŒ‡å‘ item æœ¬èº«ï¼Œä½¿ `item.id` èƒ½æ­£å¸¸è®¿é—®
1. æ‹¼æ¥ slot åå­—æ—¶ä¸ä½¿ç”¨ `item.id`Â  è€Œæ˜¯ä½¿ç”¨ `item`

ç»“è®ºæ˜¯ï¼Œæ–¹æ¡ˆä¸€å¯è¡Œï¼›æ–¹æ¡ˆäºŒä¸å¯è¡Œã€‚

è‡³äºä¸ºä»€ä¹ˆæ–¹æ¡ˆäºŒä¸å¯è¡Œï¼Œæˆ‘è®¤ä¸ºæ˜¯ uni-app çš„é—®é¢˜ï¼Œå› ä¸ºæ‰“å°å‡ºæ¥çš„å€¼æ˜¯æ­£ç¡®çš„ã€‚

ä½†æ ¹æ® Vue [å®˜æ–¹æ–‡æ¡£](https://cn.vuejs.org/v2/guide/list.html#%E7%BB%B4%E6%8A%A4%E7%8A%B6%E6%80%81)æŒ‡å‡ºï¼š

> ä¸è¦ä½¿ç”¨å¯¹è±¡æˆ–æ•°ç»„ä¹‹ç±»çš„éåŸºæœ¬ç±»å‹å€¼ä½œä¸º v-for çš„ keyã€‚è¯·ç”¨å­—ç¬¦ä¸²æˆ–æ•°å€¼ç±»å‹çš„å€¼ã€‚

**ç»“è®ºäºŒï¼šåœ¨ v-for ä¸­è¦æ ¹æ®å½“å‰é¡¹çš„å­—æ®µæ¥æ‹¼æ¥ slot åå­—ï¼Œåˆ™è¦å°† key æŒ‡å‘ `item` Â  æœ¬èº«ã€‚**

æœ€åä¸€ä¸ªè§£å†³æ–¹æ¡ˆï¼Œé‚£å°±æ˜¯é€šè¿‡ index æ‹¼æ¥ slot åå­—ï¼š

```html
<template>
  <view>
    testing dynamic slot
    <view v-for="(item, index) in list" :key="item.id">
      {{ item.name }}
      <slot :name="`tab:${index}`"></slot>
    </view>
  </view>
</template>

<script>
  export default {
    data() {
      return {
        list: [
          {
            id: "a",
            name: "item-a",
          },
          {
            id: "b",
            name: "item-b",
          },
          {
            id: "c",
            name: "item-c",
          },
        ],
      };
    },
  };
</script>
```

ä»¥ä¸Šä»£ç èƒ½åœ¨ APP ç«¯æ­£å¸¸è¿è¡Œã€‚

**ç»“è®ºä¸‰ï¼šæ‹¿ v-for çš„ index æ¥æ‹¼æ¥ slot åå­—ã€‚**

ä½†æ¯•ç«Ÿæ˜¯ HACKï¼Œç»ˆç©¶åŸå› æ˜¯ uni-app ç›®å‰ä»æ²¡æœ‰åœ¨ APP ç«¯æ”¯æŒå®šä¹‰åŠ¨æ€ slot ï¼Œå¯è§ç›¸å…³çš„è®¨è®ºï¼š

- [https://ask.dcloud.net.cn/question/95109](https://ask.dcloud.net.cn/question/95109)
- å¦‚ä½•è¯„ä»· uni-appï¼Ÿ - è˜‘è‡ç‹çš„å›ç­” - çŸ¥ä¹ [https://www.zhihu.com/question/309490398/answer/1181409781](https://www.zhihu.com/question/309490398/answer/1181409781)

æ‰€ä»¥ uni-app å®˜æ–¹ä»€ä¹ˆæ—¶å€™æ”¯æŒåŠ¨æ€ slot åå­—å‘¢ï¼Ÿ

## 7. å°ç¨‹åºç«¯ v-for ä¸­ä½¿ç”¨ v-if é—®é¢˜

### é—®é¢˜æè¿°

è¿™ä¸ªé—®é¢˜éœ€è¦åŒæ—¶æ»¡è¶³ä»¥ä¸‹æ¡ä»¶æ‰ä¼šè§¦å‘ï¼š

1. åœ¨ v-for å†…éƒ¨ä½¿ç”¨äº† v-if
1. v-if çš„æ–­è¨€ä¾èµ–äº† methods æˆ–è€… é—­åŒ… computedï¼ˆå°±æ˜¯éœ€è¦æ ¹æ®å…¥å‚åŠ¨æ€è¿”å›ç»“æœ
1. åœ¨ v-for å†…éƒ¨ç›´æ¥ä½¿ç”¨äº†å°ç¨‹åºç«¯çš„è¯­æ³•

### æ’æŸ¥è¿‡ç¨‹

å¤ç°ä»£ç å¦‚ä¸‹ï¼š

```html
// tab-swiper.vue
<template>
  <view class="list">
    <view v-for="(item, index) in list" :key="item.id" class="item">
      <!-- HACK: uni-app å¤„ç†åŠ¨æ€ slot åå­—ä¸å…¼å®¹ï¼Œéœ€è¦ä½¿ç”¨ä¸åŒçš„è¯­æ³• -->
      <!-- #ifdef H5 -->
      <slot :name="`tab:${item.id}`"></slot>
      <!-- #endif -->
      <!-- #ifndef H5-->
      <!-- @see https://ask.dcloud.net.cn/question/82506 -->
      <slot name="tab:{{item.id}}"></slot>
      <!-- #endif -->
    </view>
  </view>
</template>

<script>
  export default {
    data() {
      return {
        list: [
          {
            id: "recommend",
            name: "æ¨è",
          },
          {
            id: "public",
            name: "å…¬å…±çŸ¥è¯†",
          },
          {
            id: "professional",
            name: "ä¸“ä¸šé¡¹çŸ¥è¯†",
          },
        ],
      };
    },
  };
</script>
```

index.vue

```html
<template>
  <tab-swiper>
    <view slot="tab:recommend">recommend</view>
    <view slot="tab:public">public</view>
    <view slot="tab:professional">professional</view>
  </tab-swiper>
</template>

<script>
  import TabSwiper from "@/components/tab-swiper";
  export default {
    components: {
      TabSwiper,
    },
  };
</script>
```

ä¸Šé¢ä»£ç ä¸€åˆ‡è¿è¡Œæ­£å¸¸ï¼Œslot ä¹Ÿèƒ½æ­£å¸¸æ˜¾ç¤ºï¼š

![](https://gd4ark-1258805822.cos.ap-guangzhou.myqcloud.com/images/20210728093432.png)
ç„¶è€Œï¼Œåªè¦æˆ‘æŠŠä»£ç æ”¹æˆè¿™æ ·ï¼š

```diff
<template>
  <view class="list">
    <view v-for="(item, index) in list" :key="item.id" class="item">
+      <block v-if="isShow(index)">
+        <view>æ˜¾ç¤ºæˆ‘</view>
+      </block>
      <!-- HACK: uni-app å¤„ç†åŠ¨æ€ slot åå­—ä¸å…¼å®¹ï¼Œéœ€è¦ä½¿ç”¨ä¸åŒçš„è¯­æ³• -->
      <!-- #ifdef H5 -->
      <slot :name="`tab:${item.id}`"></slot>
      <!-- #endif -->
      <!-- #ifndef H5-->
      <!-- @see https://ask.dcloud.net.cn/question/82506 -->
      <slot name="tab:{{item.id}}"></slot>
      <!-- #endif -->
    </view>
  </view>
</template>

<script>
export default {
  data() {
    return {
      list: [
        {
          id: 'recommend',
          name: 'æ¨è',
        },
        {
          id: 'public',
          name: 'å…¬å…±çŸ¥è¯†',
        },
        {
          id: 'professional',
          name: 'ä¸“ä¸šé¡¹çŸ¥è¯†',
        },
      ],
    }
  },
+  methods: {
+   isShow(index) {
+     return index % 2 === 0
+   },
+  },
}
</script>
```

ç»“æœç«‹é©¬å˜æˆè¿™æ ·äº†ï¼š

![](https://gd4ark-1258805822.cos.ap-guangzhou.myqcloud.com/images/20210728093448.png)

é‚£ä¸‰ä¸ª slot å“ªå»äº†ï¼Ÿåˆ«æ€¥ï¼Œè®©æˆ‘ä»¬å¯¹æ¯”ä¸€ä¸‹ä¸¤è€…ç”Ÿæˆçš„å¾®ä¿¡å°ç¨‹åºä»£ç ï¼š

```html
<!-- è¿™æ˜¯æ­£å¸¸çš„ -->
<view class="list">
  <block wx:for="{{list}}" wx:for-item="item" wx:for-index="index" wx:key="id">
    <view class="item">
      <slot name="tab:{{item.id}}"></slot>
    </view>
  </block>
</view>

<!-- è¿™æ˜¯å¼‚å¸¸çš„ -->
<view class="list">
  <block
    wx:for="{{$root.l0}}"
    wx:for-item="item"
    wx:for-index="index"
    wx:key="id"
  >
    <view class="item">
      <block wx:if="{{item.m0}}">
        <block>
          <view>æ˜¾ç¤ºæˆ‘</view>
        </block>
      </block>
      <slot name="tab:{{item.id}}"></slot>
    </view>
  </block>
</view>
```

ä¸‹é¢å¼€å§‹ã€Œæ‰¾ä¸åŒã€ï¼Œæˆ‘ä»¬å‘ç°æœ€å¤§çš„ä¸åŒæ˜¯ï¼š `wx:for` çš„å€¼ä¸ä¸€æ ·ï¼Œäºæ˜¯æˆ‘ä»¬çœ‹ä¸‹ `$root.l0` çš„å®šä¹‰ï¼š

![](https://gd4ark-1258805822.cos.ap-guangzhou.myqcloud.com/images/20210728093530.png)

æˆ‘ä»¬å‘ç°ï¼Œåœ¨ `$root.l0` ä¸‹çš„æ¯ä¸€ä¸ª item é¡¹éƒ½å¤šäº†ä¸€å±‚ `$orig` æ”¾ç½®åŸæœ¬çš„å†…å®¹ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¸‹é¢è¿™è¡Œä»£ç å¹¶ä¸èƒ½è®¿é—®åˆ°å®ƒçš„ id å€¼ï¼š

```html
<slot name="tab:{{item.id}}"></slot>
```

æˆ‘ä»¬è¯•ç€æŠŠè¿™ä¸ªå€¼è¾“å‡ºæ¥çœ‹çœ‹ï¼š

```diff
+ å½“å‰ï¼š{{ item.id }}
<slot name="tab:{{item.id}}"></slot>
```

ä½ ä¼šå‘ç°å±…ç„¶èƒ½æ˜¾ç¤ºå‡ºæ¥ï¼š

![](https://gd4ark-1258805822.cos.ap-guangzhou.myqcloud.com/images/20210728093542.png)

å†çœ‹çœ‹ç”Ÿæˆçš„å¾®ä¿¡å°ç¨‹åºä»£ç ï¼Œç»ˆäºçŸ¥é“å…¶ä¸­çš„å¥¥å¦™ï¼š

```html
<view class="list">
  <block
    wx:for="{{$root.l0}}"
    wx:for-item="item"
    wx:for-index="index"
    wx:key="id"
  >
    <view class="item">
      <block wx:if="{{item.m0}}">
        <block>
          <view>æ˜¾ç¤ºæˆ‘</view>
        </block> </block
      >{{'å½“å‰ï¼š'+item.$orig.id+''}}<slot name="tab:{{item.id}}"></slot>
    </view>
  </block>
</view>
```

### è§£å†³æ–¹æ¡ˆ

åŸæ¥æ˜¯ uni-app è‡ªåŠ¨å¸®æˆ‘ä»¬æ·»åŠ äº† `$orig` ï¼Œä½†ç”±äº slot é‚£ä¸€è¡Œæˆ‘ä»¬ç›´æ¥ç”¨äº†å¾®ä¿¡å°ç¨‹åºçš„è¯­æ³•ï¼Œæ‰€ä»¥å¹¶æ²¡æœ‰å¸®æˆ‘ä»¬æ·»åŠ  `$orig` ï¼Œé‚£ä¹ˆè§£å†³æ–¹æ¡ˆå°±æ˜¯è‡ªå·±æ‰‹åŠ¨åŠ ä¸Šå‘—ï¼š

```diff
- <slot name="tab:{{item.id}}"></slot>
+ <slot name="tab:{{item.$orig.id}}"></slot>
```

é—®é¢˜æ˜¯è§£å†³äº†ï¼Œé‚£ä¹ˆä¸ºä»€ä¹ˆä¼šè¿™æ ·å‘¢ï¼Ÿåº”è¯¥æ˜¯ uni-app çš„è½¬æ¢æœºåˆ¶ï¼Œå‘ç° v-for å’Œ v-if å­˜åœ¨ä¸€å®šå…³è”ï¼Œå°±æŠŠå®ƒä»¬ç»™ç¼“å­˜äº†ï¼Œæ‰ä¼šå‡ºç°è¿™ç§é—®é¢˜ã€‚

**æ ¸å¿ƒè¦ç‚¹ï¼šå½“å¾®ä¿¡å°ç¨‹åºç«¯å¼‚å¸¸æ—¶ï¼Œä¸å¦¨çœ‹çœ‹ç”Ÿæˆçš„ä»£ç ï¼Œè¯´ä¸å®šæœ‰æ”¶è·å“¦ã€‚**

## 8. å°ç¨‹åºç«¯ç¦æ­¢äº‹ä»¶å†’æ³¡

### é—®é¢˜æè¿°

åœ¨å°ç¨‹åºç«¯æ— æ³•åŠ¨æ€é˜»æ­¢äº‹ä»¶å†’æ³¡ï¼Œä¹Ÿå³ï¼Œåœ¨ js ä¸­ä½¿ç”¨å¦‚ä¸‹æ— æ•ˆï¼š

```javascript
handleClick(e) {
    e.stopPropagation() // é™¤äº†åœ¨ h5ï¼Œå…¶å®ƒç«¯å‡æ— æ•ˆ
    e.preventDefault() // åŒä¸Š
},
```

åªèƒ½ä½¿ç”¨ä¿®é¥°ç¬¦ï¼š

```html
<u-button @click.native.stop="doSomething"></u-button>
```

æ³¨æ„ï¼šéœ€è¦åŠ  `native` ï¼Œå¦åˆ™å¯èƒ½æ— æ³•æ— æ•ˆã€‚

å‚è€ƒé“¾æ¥ï¼š[https://github.com/dcloudio/uni-app/issues/1067](https://github.com/dcloudio/uni-app/issues/1067)

å…³äº uni-app ä¸­çš„ä¿®é¥°ç¬¦å…¼å®¹æƒ…å†µï¼š[äº‹ä»¶ä¿®é¥°ç¬¦ â€”â€” uni-app](https://uniapp.dcloud.io/vue-basics?id=%e4%ba%8b%e4%bb%b6%e4%bf%ae%e9%a5%b0%e7%ac%a6)

å¾ˆæ˜¾ç„¶ï¼Œ ä½¿ç”¨äº‹ä»¶ä¿®é¥°ç¬¦çš„ç¼ºç‚¹æ˜¯æ— æ³•åŠ¨æ€å†³å®šæ˜¯å¦é˜»æ­¢äº‹ä»¶å†’æ³¡ï¼Œå¦‚æœæœ‰è¿™ç§éœ€æ±‚ï¼Œæä¾›ä¸ª hack æ€è·¯ï¼š

- åœ¨å¤–é¢åŒ…ä¸€å±‚ï¼Œåˆ©ç”¨ css çš„ pointer-events å±æ€§å†³å®šæ˜¯å¦è§¦å‘å†…å±‚çš„ dom äº‹ä»¶

å¦å¤–è¿˜æœ‰ä¸€ä¸ªå‘ï¼Œå‡è®¾æœ‰å¦‚ä¸‹ä»£ç ï¼š

```html
<template>
  <view class="container" @click="show = false">
    <u-icon name="plus-circle-fill" @click.native.stop="show = !show" />
    <view v-show="show" class="message">è¿™æ˜¯ä¸€æ¡ä¿¡æ¯</view>
  </view>
</template>

<script>
  export default {
    data() {
      return {
        show: false,
      };
    },
  };
</script>
```

ä¸Šè¿°ä»£ç æƒ³è¦å®ç°å½“ç‚¹å‡» icon æ—¶åˆ‡æ¢æ˜¾ç¤º messageï¼Œè€Œç‚¹å‡» icon ä»¥å¤–çš„ä»»æ„åœ°æ–¹åˆ™éšè— messageã€‚

åœ¨ H5 è¿è¡Œæ­£å¸¸ï¼Œä½†æ˜¯åœ¨å°ç¨‹åºç«¯å´ä¼šæŠ¥å¦‚ä¸‹é”™è¯¯ï¼š

> TypeError: Cannot read property 'stopPropagation' of undefined

è¿™æ˜¯å› ä¸ºæˆ‘ä»¬ç›´æ¥åœ¨ `@click` çš„äº‹ä»¶ç»‘å®šä¸­å†™äº†ä»£ç ï¼Œè€Œå¦‚æœæ”¹æˆç»‘å®š `methods` åˆ™æ²¡æœ‰è¯¥é—®é¢˜ï¼š

```diff
<template>
  <view class="container" @click="show = false">
-    <u-icon name="plus-circle-fill" @click.native.stop="show = !show" />
+    <u-icon name="plus-circle-fill" @click.native.stop="toggleShowMessage" />
    <view v-show="show" class="message">è¿™æ˜¯ä¸€æ¡ä¿¡æ¯</view>
  </view>
</template>

<script>
export default {
  data() {
    return {
      show: false,
    }
  },

+  methods: {
+    toggleShowMessage() {
+      this.show = !this.show
+    },
+  },
}
</script>
```

å‡ºç°è¯¥é—®é¢˜çš„åŸå› ï¼šå¦‚æœç›´æ¥åœ¨ Vue çš„äº‹ä»¶ç»‘å®šä¸­ç¼–å†™å•è¡Œä»£ç ï¼ˆä¸æ˜¯ç»‘å®šå…·ä½“çš„æ–¹æ³•ï¼‰ï¼Œè€Œ uni-app è½¬æ¢ä¸ºå°ç¨‹åºç«¯ä»£ç æ—¶ä¼šå°†å®ƒæ”¾åˆ° `.js` æ–‡ä»¶çš„æ–¹æ³•ä¸­ï¼Œå¹¶ä¸”ç”±äºä½¿ç”¨äº† `.stop` äº‹ä»¶ä¿®é¥°ç¬¦ï¼Œä¹Ÿåœ¨è¯¥æ–¹æ³•ä¸­æ·»åŠ äº† `$event.stopPropagation()` ï¼Œç„¶è€Œå°ç¨‹åºç«¯æ‰“å° `$event` æ ¹æœ¬å°±æ˜¯ `undefind` ï¼Œæ‰€ä»¥å¯¼è‡´é”™è¯¯ï¼Œå¯ä»¥çœ‹çœ‹ç”Ÿæˆçš„å°ç¨‹åºä»£ç ï¼š

![](https://gd4ark-1258805822.cos.ap-guangzhou.myqcloud.com/images/20210728093710.png)

è¿™åº”è¯¥æ˜¯ uni-app çš„é—®é¢˜ï¼Œå…³äºè¿™ä¸ªé—®é¢˜æ›´è¯¦ç»†çš„æè¿°å¯ä»¥çœ‹æˆ‘åœ¨ uni-app ä»“åº“æçš„è¿™ä¸ª [issue](https://github.com/dcloudio/uni-app/issues/2400)ã€‚

### è§£å†³æ–¹æ¡ˆ

**æ€»ä¹‹ï¼šå°½é‡ä¸è¦åœ¨äº‹ä»¶ç»‘å®šä¸­ä½¿ç”¨å•è¡Œä»£ç ï¼Œç‰¹åˆ«æ˜¯ä½¿ç”¨äº†äº‹ä»¶ä¿®é¥°ç¬¦çš„æ—¶å€™ã€‚**

## 9. uView ä¸¤å±‚ tabsSwiper left è®¡ç®—é—®é¢˜

ä½¿ç”¨ uView çš„ tabSwiper ç»„ä»¶æ—¶ï¼Œå¦‚æœå­˜åœ¨ä¸¤å±‚æˆ–å¤šå±‚åµŒå¥—ï¼Œä¼šå‡ºç°å†…å±‚çš„ swiper-item çš„ left å€¼è®¡ç®—é”™è¯¯ï¼Œè¿™æ˜¯ uView çš„ bugï¼Œå…·ä½“é—®é¢˜æè¿°å’Œä¸´æ—¶è§£å†³æ–¹æ¡ˆå¯è§ï¼š[https://github.com/YanxinNet/uView/issues/749](https://github.com/YanxinNet/uView/issues/749)

## 10. scss æ–‡ä»¶è¿›è¡Œæ¡ä»¶æ¸²æŸ“

åœ¨ `.scss` Â  æ–‡ä»¶ä¸­è¿›è¡Œ uni-app çš„æ¡ä»¶æ¸²æŸ“ï¼Œå¿…é¡»ä¸ºå¤šè¡Œæ³¨é‡Šï¼Œå¦‚ä¸‹ï¼š

```css
/* #ifdef MP-WEIXIN */
.u-btn {
  color: red !important;
}

/* #endif */
```

å¦å¤–ï¼Œå¦‚æœåœ¨ `.vue` Â  ä¸­çš„ `style` Â  æ ‡ç­¾ï¼Œåˆ™æ— è®ºä½¿ç”¨å•è¡Œæ³¨é‡Šè¿˜æ˜¯å¤šè¡Œæ³¨é‡Šï¼Œéƒ½æ˜¯æœ‰æ•ˆçš„ã€‚

## 11. æ–¹æ³•åä¸èƒ½ä¸ç”Ÿå‘½å‘¨æœŸåå­—å†²çª

å¦‚é¢˜ï¼Œå†™åœ¨ `methods` Â  ä¸‹çš„æ–¹æ³•åå­—ä¸è¦ä¸ç”Ÿå‘½å‘¨æœŸä¸€è‡´ï¼Œå¦åˆ™ä¼šå‡ºç°é”™è¯¯ï¼Œè¿™é‡Œçš„ç”Ÿå‘½å‘¨æœŸåŒ…æ‹¬ï¼š

- [Vue ç”Ÿå‘½å‘¨æœŸ](https://uniapp.dcloud.io/use?id=%e7%94%9f%e5%91%bd%e5%91%a8%e6%9c%9f%e9%92%a9%e5%ad%90)
- [uni-app ç”Ÿå‘½å‘¨æœŸ](https://uniapp.dcloud.io/collocation/frame/lifecycle?id=%e5%ba%94%e7%94%a8%e7%94%9f%e5%91%bd%e5%91%a8%e6%9c%9f)

## 12. è°ƒè¯• uView ç»„ä»¶

å¦‚æœä½¿ç”¨ uView ç»„ä»¶è¿‡ç¨‹ä¸­é‡åˆ°è«åå…¶å¦™çš„é—®é¢˜ï¼Œå»ºè®®ä½¿ç”¨æ–­ç‚¹è°ƒè¯•ï¼Œå¯å¸®åŠ©ä½ å¿«é€Ÿå®šä½é—®é¢˜ã€‚

ä¸¾ä¸ªä¾‹å­ï¼Œæƒ³çœ‹çœ‹ `u-tabs-swiper` Â Â  ç»„ä»¶çš„æŸä¸ªæ–¹æ³•æ‰§è¡Œè¿‡ç¨‹ï¼Œå¯ä»¥åˆ° `node_modules/uview-ui/components/u-tabs-swiper/u-tabs-swiper.vue` Â ï¼Œæ‰¾åˆ°ä½ æƒ³è°ƒè¯•çš„æ–¹æ³•ï¼Œæ‰“ä¸ªæ–­ç‚¹ï¼š

![](https://gd4ark-1258805822.cos.ap-guangzhou.myqcloud.com/images/20210728093759.png)ç„¶ååœ¨æµè§ˆå™¨åˆ·æ–°ï¼Œè¿›è¡ŒæŸäº›æ“ä½œä»¥ä¾¿è§¦å‘ä½ æƒ³è°ƒè¯•çš„æ–¹æ³•ï¼Œç„¶åå°±å¯ä»¥è¿›è¡Œæ–­ç‚¹è°ƒè¯•äº†ï¼š

é—æ†¾çš„æ˜¯ uni-app çš„è‡ªå¸¦ç»„ä»¶ï¼Œè™½ç„¶ä¹Ÿå¯ä»¥åœ¨ node-module ç›®å½•ä¸‹æ‰¾åˆ°å¯¹åº”çš„æºç ä½ç½®ï¼Œä½†å› ä¸ºæ˜¯é¢„ç¼–è¯‘å¥½çš„ï¼Œæ‰€ä»¥è¿›è¡Œä¿®æ”¹æ— æ•ˆï¼Œè‡ªç„¶ä¹Ÿä¸èƒ½æ‰“æ–­ç‚¹ã€‚

å¤§éƒ¨åˆ† uni-app çš„ç»„ä»¶éƒ½åœ¨ï¼š `node_modules/@dcloudio/uni-h5/src` Â  ä¸‹ã€‚

**æ ¸å¿ƒè¦ç‚¹ï¼šå½“ç»„ä»¶è«åå…¶å¦™åœ°è¡¨ç°ä¸æ­£å¸¸æ—¶ï¼Œåˆ«å¿˜äº†ä½¿ç”¨æ–­ç‚¹è°ƒè¯•ã€‚**

## 13. SwipeAction ç»„ä»¶æ— æ³•è‡ªåŠ¨éšè—æŒ‰é’®

### é—®é¢˜æè¿°

åœ¨ä½¿ç”¨ SwipeAction ç»„ä»¶æ—¶ï¼Œå‘ç°åœ¨å°ç¨‹åºç«¯ä¸‹çš„ã€Œç‚¹å‡»æ”¶è—æŒ‰é’®åéšè—æŒ‰é’®ã€åŠŸèƒ½ä¸æ­£å¸¸ï¼Œåœ¨å®˜æ–¹ç¤ºä¾‹ç¨‹åºä¹Ÿå¯å¤ç°è¯¥é—®é¢˜ï¼š

![img](https://gd4ark-1258805822.cos.ap-guangzhou.myqcloud.com/images/20210728094505.gif)

ä½†å®é™…ä¸Šåœ¨ H5 ç«¯å®ƒæ˜¯æ­£å¸¸çš„ï¼š

![img](https://gd4ark-1258805822.cos.ap-guangzhou.myqcloud.com/images/20210728094538.gif)

æ·±å…¥åˆ†ææºç åï¼Œå‘ç°ç‚¹å‡»æ”¶è—æŒ‰é’®æ—¶ï¼Œ `btnClick` å’Œ `touchend` ä¸¤ä¸ªæ–¹æ³•çš„æ‰§è¡Œé¡ºåºåœ¨ H5 å’Œ å°ç¨‹åºç«¯ä¸­è¡¨ç°ä¸ä¸€è‡´ï¼Œåˆ†åˆ«åœ¨ä¸¤ä¸ªæ–¹æ³•ä¸­åŠ å…¥ `console.log` ï¼Œè¿è¡Œç»“æœæ˜¯ï¼š

- H5

![img](https://gd4ark-1258805822.cos.ap-guangzhou.myqcloud.com/images/20210728094614.png)

- MP-WEIXIN

![img](https://gd4ark-1258805822.cos.ap-guangzhou.myqcloud.com/images/20210728094625.png)

è€Œä¹‹æ‰€ä»¥åœ¨å°ç¨‹åºç«¯è¿è¡Œå¼‚å¸¸ï¼Œ å°±æ˜¯å› ä¸ºå…ˆæ‰§è¡Œäº† `btnClick` æ–¹æ³•ï¼Œè€Œ `btnClick` å†…éƒ¨å°† `this.status = false` ï¼Œå¯¼è‡´éšåæ‰§è¡Œ `touchend` æ—¶è¿›å…¥äº†é”™è¯¯çš„æ¡ä»¶åˆ†æ”¯ã€‚

### è§£å†³æ–¹æ¡ˆ

è¿™é—®é¢˜æ€ä¹ˆè§£å†³ï¼Ÿåœ¨ä¸ä¿®æ”¹ç»„ä»¶æºä»£ç çš„æ—¶å€™ä¸‹ï¼Œåªèƒ½ä½¿ç”¨ä¸‹é¢è¿™ç§æ–¹å¼ HACKï¼š

```
methods: {
    click(index, index1) {
      if (index1 == 1) {
        this.list.splice(index, 1)
        this.$u.toast(`åˆ é™¤äº†ç¬¬${index}ä¸ªcell`)
      } else {
        // #ifdef MP-WEIXIN
        /**
         * HACK: åœ¨ MP-WEIXN è¡¨ç°å¼‚å¸¸ï¼Œä¸ºé¿å…è¢«è¦†ç›–ï¼Œéœ€è¦è¿‡ä¸€æ®µæ—¶é—´å†æ›´æ–°å€¼
         * @see https://github.com/YanxinNet/uView/issues/761
         */
        setTimeout(() => {
          this.list[index].show = false
        }, 100)
        // #endif
        // #ifndef MP-WEIXIN
        this.list[index].show = false
        // #endif
        this.$u.toast(`æ”¶è—æˆåŠŸ`)
      }
    },
  },
```

å·²å‘ uView æ issueï¼šhttps://github.com/YanxinNet/uView/issues/761

## 14. IOS åº•éƒ¨ç©ºç™½å®‰å…¨åŒºåŸŸ

å­é¡µé¢åœ¨ IOS ä¼šå‡ºç°ä¸€ä¸ªç©ºç™½çš„å®‰å…¨åŒºåŸŸï¼Œå¯ä»¥é€šè¿‡ä¿®æ”¹ `manifest.json` Â  ç¦ç”¨å®ƒï¼š

```json
{
  "app-plus": {
    "safearea": {
      "bottom": {
        "offset": "none"
      }
    }
  }
}
```

å‚è€ƒæ–‡æ¡£ï¼š[uni-app å…¨é¢å±ã€åˆ˜æµ·å±é€‚é…ï¼ˆiphoneX é€‚é…ï¼‰åŠå®‰å…¨åŒºè®¾ç½®](https://ask.dcloud.net.cn/article/35564)

## 15. APP ç«¯é”å®šå±å¹•æ–¹å‘

é€šè¿‡ `manifest.json` çš„ [orientation](https://uniapp.dcloud.io/collocation/manifest?id=distribute) é€‰é¡¹å¯ä»¥è¿›è¡Œæ¨ªç«–å±é…ç½®ï¼š

```json
{
  "distribute": {
    "orientation": ["portrait-primary"]
  }
}
```

ä½†å¦‚æœåœ¨æµ‹è¯•åŸºåº§ï¼Œ ä»¥ä¸Šé€‰é¡¹ä¼šå¤±æ•ˆï¼Œæ‰€ä»¥æœ€ä¿é™©çš„æ–¹å¼æ˜¯åœ¨ `APP.vue` Â  ä¸­è¿›è¡Œé…ç½®ï¼š

```javascript
export default {
  onLaunch() {
    // #ifdef APP-PLUS
    // é”å®šç«–å±
    plus.screen.lockOrientation("portrait-primary");
    // #endif
  },
};
```

ä½¿ç”¨è¯¥ API è¿˜å¯ä»¥å®ç°ä»…å…è®¸ç‰¹å®šé¡µé¢æ—‹è½¬æ–¹å‘ï¼Œå…³äºæ›´å¤šå¯è§ï¼š[HTML+ API Reference](https://www.html5plus.org/doc/zh_cn/device.html)

å…³äºå±å¹•æ—‹è½¬çš„æ›´å¤šå¯å‚è€ƒï¼š

- [globalStyle.pageOrientation](https://uniapp.dcloud.io/collocation/pages?id=globalstyle)
- [orientation](https://uniapp.dcloud.io/collocation/manifest?id=distribute)

## 16. uButton è‡ªå®šä¹‰æ ·å¼

æ ¹æ® uView [æ–‡æ¡£](https://uviewui.com/components/button.html) è¯´æ˜ï¼Œå¦‚æœæƒ³è¦ç»™ button è‡ªå®šä¹‰æ ·å¼ï¼Œä¸ºäº†å…¼å®¹å°ç¨‹åºï¼Œåˆ™è¦åœ¨ç»„ä»¶ä¸­ä¼ é€’ `custom-style` Â  å±æ€§ï¼Œä¹Ÿå°±æ„å‘³ç€éœ€è¦æŠŠ CSS å†™åœ¨ JS ä¸­ï¼Œè¿™ä¸æ˜¯æˆ‘ä»¬æƒ³è¦çš„ï¼Œæ¯•ç«Ÿè¿™æ ·å°±æ— æ³•ä½¿ç”¨ Scss ä¸­çš„å˜é‡äº†ã€‚

ä¸ºä»€ä¹ˆè¦è¿™ä¹ˆéº»çƒ¦å‘¢ï¼Ÿå› ä¸ºåœ¨å°ç¨‹åºç«¯ï¼ŒåŸæœ¬æ˜¯ä¸€å±‚çš„å…ƒç´ ï¼Œè¢«å®ƒææˆä¸¤å±‚äº†ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¼ é€’è¿‡å»çš„ class å±æ€§åªåº”ç”¨åœ¨å¤–å±‚ï¼Œè€Œå†…å±‚æ‰æ˜¯çœŸæ­£ buttonã€‚

ä¸¾ä¸ªä¾‹å­ï¼š

```html
<template>
  <view class="test-page">
    <u-button class="btn">æŒ‰é’®</u-button>
  </view>
</template>

<style lang="scss">
  .test-page {
    .btn {
      color: red;
    }
  }
</style>
```

ä»¥ä¸Šä»£ç åœ¨ H5 çš„è¡¨ç°æ˜¯æ­£å¸¸çš„ï¼š

![](https://gd4ark-1258805822.cos.ap-guangzhou.myqcloud.com/images/20210728094742.png)
ä½†åœ¨å°ç¨‹åºçš„è¡¨ç°å´æ˜¯è¿™æ ·çš„ï¼š

![](https://gd4ark-1258805822.cos.ap-guangzhou.myqcloud.com/images/20210728094757.png)

å¦‚æœæƒ³ CSS å±‚é¢è§£å†³è¯¥é—®é¢˜ï¼Œé‚£å°±æ˜¯éƒ½å°†å®ƒä»¬éƒ½ä½œä¸ºé€‰æ‹©å™¨å³å¯ï¼š

```diff
<template>
  <view class="test-page">
    <u-button class="btn">æŒ‰é’®</u-button>
  </view>
</template>

<style lang="scss">
.test-page {
  .btn {
+    &,
+    button {
      color: red;
+    }
  }
}
</style>
```

è™½ç„¶çœ‹ä¸Šå»å¾ˆä¸‘ï¼Œä½†èƒ½ workï¼Œä¸”å…¼å®¹æ€§è¾ƒå¥½ï¼Œæ‰€ä»¥æ¨èä½¿ç”¨è¯¥æ–¹å¼ã€‚

## 17. uButton æ— æ³•è‡ªå®šä¹‰ hover-class

æ ¹æ® uView [æ–‡æ¡£](https://uviewui.com/components/button.html) è¯´æ˜ï¼ŒButton ç»„ä»¶æœ‰ hover-class å±æ€§ï¼Œå¯è‡ªå®šä¹‰ hover æ—¶çš„ classï¼Œä½†å®é™…ä½¿ç”¨å¹¶æ— æ•ˆæœï¼ŒæŸ¥çœ‹æºä»£ç åå‘ç°ä»£ç å­˜åœ¨é—®é¢˜ã€‚

ç›®å‰ GitHub ä¸Šå·²æœ‰äººæŒ‡å‡ºè¯¥é—®é¢˜ï¼Œä½†ç»´æŠ¤è€…ä»æœªå¤„ç†ï¼š

- [u-button hover-class æ— æ•ˆ](https://github.com/YanxinNet/uView/issues/662)
- [ä¿®å¤ button ç»„ä»¶ hoverClass ä¸ç”Ÿæ•ˆçš„é—®é¢˜](https://github.com/YanxinNet/uView/pull/741/files)

åœ¨ä¸ä¿®æ”¹åŸç»„ä»¶çš„æƒ…å†µä¸‹ï¼Œåªèƒ½é€šè¿‡å¼ºåˆ¶è¦†ç›–å®ƒé»˜è®¤çš„ hover-class çš„æ ·å¼æ¥è§£å†³è¯¥é—®é¢˜ï¼š

```html
<template>
  <view class="test-page">
    <u-button class="btn">é€€å‡ºç™»å½•</u-button>
  </view>
</template>

<style lang="scss">
  .test-page {
    // HACK: ç”±äº uButton çš„ hover-class ä¼ é€’æ— æ•ˆï¼Œæš‚æ—¶åªèƒ½é€šè¿‡è¯¥æ–¹å¼è‡ªå®šä¹‰
    /deep/ .btn {
      &.u-default-hover,
    // å…¼å®¹å°ç¨‹åº
    button.u-default-hover {
        color: white !important;
        background: rgba($color-primary, 0.8) !important;
      }
    }
  }
</style>
```

æ³¨æ„ï¼š

1. ä¸ºäº†é¿å…å½±å“å…¶å®ƒ buttonï¼Œéœ€è¦é™åˆ¶é€‰æ‹©å™¨èŒƒå›´
1. class ä¸ä¸€å®šæ˜¯ `u-default-hover`Â ï¼Œå¯ä»¥è‡ªè¡Œæµ‹è¯•è¯¥ button hover æ—¶å®é™…ä½¿ç”¨å“ªä¸ª class
1. å…¼å®¹å°ç¨‹åºé‚£é‡Œè¯¦è§ï¼š[18. uButton è‡ªå®šä¹‰æ ·å¼](#9WQn6)

## 18. uni-app åªèƒ½åœ¨ main.js æ³¨å†Œå…¨å±€ç»„ä»¶

### é—®é¢˜æè¿°

åœ¨å¼€å‘è¿‡ç¨‹ä¸­ï¼Œä¸å¯é¿å…éœ€è¦æ³¨å†Œä¸€äº›å…¨å±€ç»„ä»¶ï¼Œä¸ºäº†æ–¹ä¾¿ç®¡ç†ï¼Œæˆ‘ä»¬å¸Œæœ›æ”¾åˆ°ä¸€ä¸ªå•ç‹¬çš„æ–‡ä»¶ä¸­è¿›è¡Œç®¡ç†ï¼Œç±»ä¼¼ä¸‹é¢è¿™æ ·ï¼š

```javascript
// src/plugins/element.js

import BasicLayout from "@/layouts/basic";
import FullLoading from "@/components/full-loading";

export default {
  install: Vue => {
    Vue.component("BasicLayout", BasicLayout);
    Vue.component("FullLoading", FullLoading);
  },
};

// src/main.js

import element from "./plugins/element";

Vue.use(element);
```

è¿™ä¹Ÿæ˜¯åœ¨å¼€å‘ Vue é¡¹ç›®æ—¶å¸¸ç”¨çš„æ–¹æ¡ˆï¼Œä½†è¿™åœ¨å¾®ä¿¡å°ç¨‹åºç«¯ä¼šè¿è¡Œå¼‚å¸¸ï¼Œæ ¹æœ¬æ²¡æœ‰æ³¨å†Œåˆ°å…¨å±€ç»„ä»¶ã€‚

ä½†å¦‚æœå°†æ³¨å†Œå…¨å±€ç»„ä»¶çš„å·¥ä½œæ”¾åˆ° `main.js` Â ï¼Œåˆ™æ˜¯å¯ä»¥æ­£å¸¸è¿è¡Œçš„ï¼š

```javascript
import element from "./plugins/element";

/**
 * FIXME: å› ä¸æ˜åŸå› ï¼Œåœ¨ main.js å¤–çš„æ–‡ä»¶æ³¨å†Œå…¨å±€ç»„ä»¶ä¼šå¯¼è‡´ç»„ä»¶åœ¨ mp-weixin ç«¯è¡¨ç°ä¸æ­£å¸¸
 */
import BasicLayout from "@/layouts/basic";
import FullLoading from "@/components/full-loading";

Vue.component("BasicLayout", BasicLayout);
Vue.component("FullLoading", FullLoading);
```

è¯¥é—®é¢˜ä¹Ÿæ—©å°±æœ‰äººæå‡ºè¿‡ï¼Œä½†è‡³ä»Šä»æœªçœ‹åˆ°å®˜æ–¹å›¢é˜Ÿæœ‰æ‰€å›åº”ï¼Œå¯è§ï¼š

- [uni-app å…¨å±€ç»„ä»¶ app ä¸æ˜¾ç¤º](https://ask.dcloud.net.cn/question/86931)
- [ã€æŠ¥ Bugã€‘ä½¿ç”¨ Vue.use æ³¨å†Œå…¨å±€ç»„ä»¶ï¼Œå°ç¨‹åºä¸æ”¯æŒï¼](https://ask.dcloud.net.cn/question/93821)

è€Œåœ¨ uni-app å®˜æ–¹æ–‡æ¡£çš„ [å…¨å±€ç»„ä»¶](https://uniapp.dcloud.io/use?id=%e5%85%a8%e5%b1%80%e7%bb%84%e4%bb%b6) æ˜¯è¿™æ ·æè¿°çš„ï¼š
![](https://gd4ark-1258805822.cos.ap-guangzhou.myqcloud.com/images/20210728094913.png)

è™½ç„¶è¯´äº†æ–‡æ¡£éœ€åœ¨ `main.js` ä¸­è¿›è¡Œå…¨å±€æ³¨å†Œï¼Œä½†æ ¹æ®æˆ‘ä»¬ä»¥å¾€å¯¹ Vue çš„è®¤çŸ¥ï¼Œè¿™ä¸ªå·¥ä½œæ˜¯å¯ä»¥æ”¾åˆ°å¤–éƒ¨æ–‡ä»¶å»çš„ï¼Œè€Œ uni-app ä¹Ÿæ²¡æœ‰æ˜ç¡®æŒ‡å‡ºä¸€å®šåªèƒ½åœ¨ `main.js` è¿›è¡Œæ³¨å†Œå…¨å±€ç»„ä»¶ï¼Œè¿™å°±é€ æˆä¸å°‘ç”¨æˆ·å›°æ‰°ã€‚

è™½ç„¶é›†ä¸­åœ¨ `main.js` æ³¨å†Œå…¨å±€ç»„ä»¶ä¹Ÿå¹¶ä¸æ˜¯ä¸èƒ½æ¥å—ï¼Œä½†æˆ‘ä»¬éœ€è¦çŸ¥é“èƒŒåçš„åŸå› ï¼Œä¸ºä»€ä¹ˆåœ¨å¤–éƒ¨æ–‡ä»¶æ³¨å†Œå°±æ— æ•ˆï¼Ÿ

æœ¬æ–‡å°±æ¥ä¸€æ¢ç©¶ç«Ÿï¼Œäº†è§£èƒŒåçœŸæ­£çš„åŸå› ã€‚

### ç»“è®ºå…ˆè¡Œ

å…ˆè¯´ç»“è®ºï¼Œè¯´ç™½äº†å°±æ˜¯ uni-app è½¬æ¢å°ç¨‹åºä»£ç æ—¶ï¼Œæ£€æµ‹å…¨å±€ç»„ä»¶çš„æ–¹å¼æ˜¯é€šè¿‡é™æ€åˆ†æ `main.js` Â  æ–‡ä»¶ï¼Œæ‰€ä»¥åœ¨å…¶ä»–æ–‡ä»¶æ³¨å†Œå…¨å±€ç»„ä»¶çš„è¯ï¼Œuni-app å°±æ— æ³•å¾—çŸ¥äº†ã€‚

å¦‚æœæƒ³çŸ¥é“æ›´å¤šç»†èŠ‚ï¼Œæ¬¢è¿ç»§ç»­å¾€ä¸‹é˜…è¯» ğŸ‘‡

### é—®é¢˜åˆ†æ

é¦–å…ˆï¼Œæˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹åœ¨ `main.js` Â  æ³¨å†Œå…¨å±€ç»„ä»¶æ—¶ï¼Œç”Ÿæˆçš„å¾®ä¿¡å°ç¨‹åºç«¯ `pages.json` Â  çš„ `usingComponents` :

![](https://gd4ark-1258805822.cos.ap-guangzhou.myqcloud.com/images/20210728094944.png)
å¾ˆæ˜æ˜¾è¿™æ˜¯æ­£å¸¸çš„ï¼Œé‚£æˆ‘ä»¬å†çœ‹çœ‹å¦‚æœæ”¾åœ¨å¤–éƒ¨æ–‡ä»¶æ³¨å†Œå…¨å±€ç»„ä»¶çš„è¯ï¼Œå®ƒæ˜¯ç©ºçš„ï¼š
![](https://gd4ark-1258805822.cos.ap-guangzhou.myqcloud.com/images/20210728094951.png)
æ‰€ä»¥ï¼Œé—®é¢˜è‚¯å®šæ˜¯å‘ç”Ÿåœ¨ uni-app è½¬æ¢ä¸ºå°ç¨‹åºçš„è¿‡ç¨‹ä¸­ï¼Œä¸‹é¢å°±æ¥å®šä½ uni-app çš„æºç ï¼Œçœ‹çœ‹ç©¶ç«Ÿæ˜¯ä»€ä¹ˆæƒ…å†µã€‚

ä½†é—®é¢˜æ˜¯ï¼Œæˆ‘ä»¬å¹¶ä¸çŸ¥é“è¿™éƒ¨åˆ†ä»£ç åœ¨å“ªä¸ªä½ç½®ï¼Œæ ¹æœ¬ä¸çŸ¥é“ä»ä½•çœ‹èµ·ï¼Ÿï¼Ÿ

åˆ«ç€æ€¥ï¼Œæ—¢ç„¶æˆ‘ä»¬å…³å¿ƒçš„ä»£ç æ˜¯ä¸ `usingComponents` Â  çš„èµ‹å€¼ç›¸å…³çš„ï¼Œé‚£æˆ‘ä»¬å¯ä»¥è¯•è¯•åœ¨ `node_modules/@dcloudio` æœç´¢å…³é”®è¯ `usingComponents = `

![](https://gd4ark-1258805822.cos.ap-guangzhou.myqcloud.com/images/20210728095001.png)

å¯ä»¥çœ‹åˆ°ç»“æœæ¯”è¾ƒå¤šï¼Œæˆ‘ä»¬å¿«é€Ÿæ‰«ä¸€çœ¼ï¼Œå‘ç°å‡ ä¸ªæ¯”è¾ƒå¯ç–‘çš„ï¼š

![](https://gd4ark-1258805822.cos.ap-guangzhou.myqcloud.com/images/20210728095014.png)

é‚£æˆ‘ä»¬çš„åšæ³•å°±æ˜¯è¿›å…¥è¿™å‡ ä¸ªæ–‡ä»¶ï¼Œåˆ†åˆ«æ·»åŠ ä¸€è¡Œ `console.log` Â ï¼Œä»¥æ–‡ä»¶åä¸ºåŒºåˆ†ï¼š

![](https://gd4ark-1258805822.cos.ap-guangzhou.myqcloud.com/images/20210728095027.png)Â ï¼Œå¦‚æœæ‰§è¡Œäº†è¿™ä¸ªæ–‡ä»¶ï¼Œå°±ä¼šæ‰“å°å¯¹åº”çš„å€¼ï¼š

![](https://gd4ark-1258805822.cos.ap-guangzhou.myqcloud.com/images/20210728095039.png)

> æ³¨æ„ï¼šè¿™æ—¶å€™æ˜¯æŠŠå…¨å±€ç»„ä»¶æ³¨å†Œæ”¾åœ¨ `main.js` Â  ä¸­

å¾ˆæ˜æ˜¾ï¼Œæˆ‘ä»¬è¿æ°”ä¸é”™ï¼Œè¿™ä¸ª [main-new.js](https://github.com/dcloudio/uni-app/blob/master/packages/webpack-uni-mp-loader/lib/main-new.js)Â  åº”è¯¥å°±æ˜¯æˆ‘ä»¬æƒ³è¦çš„ä»£ç ï¼Œä¸‹é¢æˆ‘ä»¬å°±æ¥çœ‹çœ‹ `components` Â  è¿™ä¸ªå€¼åˆ°åº•æ˜¯æ€ä¹ˆå‡ºæ¥çš„ï¼Œ `components` Â  çš„å®šä¹‰åœ¨ [ç¬¬ 84 è¡Œ](https://github.com/dcloudio/uni-app/blob/master/packages/webpack-uni-mp-loader/lib/main-new.js#L84)ï¼š

![](https://gd4ark-1258805822.cos.ap-guangzhou.myqcloud.com/images/20210728095053.png)
å¯ä»¥çœ‹åˆ°ï¼Œ `components` Â  æ˜¯æ ¹æ®ä¼ å…¥ `content` Â  åˆ° `traverse()` Â  æ–¹æ³•åå¾—åˆ°çš„ï¼Œæˆ‘ä»¬å…ˆæ¥æ‰“å°ä¸€ä¸‹ `content` ï¼ˆä¸ºé¿å…å¹²æ‰°ï¼Œå¯ä»¥å…ˆæŠŠä¹‹å‰çš„ console.log å»æ‰ï¼‰ï¼Œç„¶åæˆ‘ä»¬çœ‹åˆ°ä»¥ä¸‹ï¼š

![](https://gd4ark-1258805822.cos.ap-guangzhou.myqcloud.com/images/20210728095103.png)
å¯ä»¥çœ‹åˆ°è¿™æ˜¯ `main.js` Â  çš„å†…å®¹ï¼Œéš¾é“æ˜¯é€šè¿‡è§£æè¿™ä¸ªæ–‡ä»¶çš„å†…å®¹å¾—åˆ°å…¨å±€ç»„ä»¶çš„ï¼Ÿ

æˆ‘ä»¬è¿˜æ˜¯çœ‹ä¸€ä¸‹å®ƒç»™ `traverse()` Â  ä¼ é€’çš„å‚æ•°ï¼Œå‘ç°æ˜¯ä¸€ä¸ªé€šè¿‡ babel è§£æåçš„ AST æ ‘ï¼š

![](https://gd4ark-1258805822.cos.ap-guangzhou.myqcloud.com/images/20210728095113.png)
ç„¶åæˆ‘ä»¬å†çœ‹çœ‹ `traverse()` Â  å†…éƒ¨ï¼Œåœ¨ [global-component-traverse.js](https://github.com/dcloudio/uni-app/blob/master/packages/webpack-uni-mp-loader/lib/babel/global-component-traverse.js)ï¼š

![](https://gd4ark-1258805822.cos.ap-guangzhou.myqcloud.com/images/20210728095125.png)
é‚£çœ‹æ¥çš„ç¡®å¦‚æ­¤ï¼Œä½†è¿™æ—¶å€™æˆ‘è¿˜æœ‰ä¸€ä¸ªç–‘é—®ï¼š**ä¸Šé¢åªæ˜¯è¯´æ˜ uni-app æ˜¯é€šè¿‡é™æ€è§£ææ–‡ä»¶å†…å®¹å¾—åˆ°å…¨å±€ç»„ä»¶ï¼Œé‚£ä¸ºä»€ä¹ˆä¸å¯ä»¥é’ˆå¯¹å…¶å®ƒæ–‡ä»¶è¿›è¡Œè§£æå‘¢ï¼Ÿ**

æˆ‘ä»¬çœ‹åˆ°å…¶å® `content` Â  æ˜¯ä»å¤–éƒ¨ä¼ å…¥çš„ï¼Œä¹Ÿå°±æ˜¯è¯´æ˜¯åˆ«çš„æ–‡ä»¶ä¼ å…¥äº† `main.js` Â  çš„å†…å®¹ï¼š

![](https://gd4ark-1258805822.cos.ap-guangzhou.myqcloud.com/images/20210728095125.png)
äºæ˜¯æœç´¢å½“å‰æ–‡ä»¶çš„å¼•ç”¨ï¼Œä¸€è·¯é¡ºè—¤æ‘¸ç“œï¼Œæ‰¾åˆ°èµ·å§‹çš„å…¥å£ï¼Œå®ƒç¡®å®æ˜¯åªé’ˆå¯¹ `main.js` Â  è¿›è¡Œè§£æï¼Œåœ¨ [vue-cli-plugin-uni/lib/mp/index.js](https://github.com/dcloudio/uni-app/blob/master/packages/vue-cli-plugin-uni/lib/mp/index.js#L112)ï¼š

![](https://gd4ark-1258805822.cos.ap-guangzhou.myqcloud.com/images/20210728095253.png)

åˆ°æ­¤ä¸ºæ­¢ï¼Œæˆ‘ä»¬å·²ç»çŸ¥é“ä¸ºä»€ä¹ˆ uni-app åªèƒ½åœ¨ `main.js` Â  æ‰èƒ½æ³¨å†Œå…¨å±€ç»„ä»¶ï¼Œè€Œå…¶å®ƒæ–‡ä»¶æ— æ•ˆäº†ã€‚

## å†™åœ¨æœ€å

æœ€åè¿˜æ˜¯å¾—å¿ƒå¹³æ°”å’Œåœ°è¯„ä»·å‡ å¥ï¼Œè™½ç„¶åœ¨ä½¿ç”¨ uni-app å¼€å‘è¿‡ç¨‹ä¸­è¸©äº†ä¸å°‘çš„å‘ï¼Œå¿ƒé‡Œä¹Ÿæ›¾ä¸æ­¢ä¸€æ¬¡æœ‰åä¸‡ä¸ªè‰æ³¥é©¬å¥”è…¾è€Œè¿‡ï¼Œä½†æ˜¯ä¸å¯å¦è®¤è¿™ä¹ˆä¸€ä¸ªå¼€å‘è·¨å¹³å°åº”ç”¨çš„å‰ç«¯æ¡†æ¶æ¥è¯´ï¼Œå®ƒåšçš„è¿˜æ˜¯æœ‰å€¼å¾—ç§°èµçš„åœ°æ–¹ï¼Œè‡³å°‘ä»ç”Ÿæ€ä¸Šé¢å°±è¶³ä»¥ç§’æ€å…¶å®ƒåŒæ ·æ˜¯ Vue è¯­æ³•çš„å¼€å‘è·¨å¹³å°æ¡†æ¶ã€‚
